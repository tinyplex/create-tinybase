// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`create-tinybase > js-react-chat > should match snapshot 1`] = `
{
  "README.md": "# test-js-react-chat

A TinyBase app built with JavaScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Chat</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Chat</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A real-time chat application demonstrating TinyBase's reactive
              data management.
              <br /><br />
              Built with JavaScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.jsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-react-chat",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.jsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {SettingsStore} from './SettingsStore';
import {ChatStore} from './ChatStore';
import {UsernameInput} from './UsernameInput';
import {Messages} from './Messages';
import {MessageInput} from './MessageInput';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <SettingsStore />
        <ChatStore />
        <UsernameInput />
        <Messages />
        <MessageInput />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Button.jsx": "import './button.css';
import {ReactNode} from 'react';

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/ChatStore.jsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useAddRowCallback,
  useRow,
  useRowIds,
  useStore,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
export const STORE_ID = 'chat';

export {useAddRowCallback, useRow, useRowIds, useStore};

export const ChatStore = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([
      {
        messages: {
          1: {username: 'Alice', text: 'Hello!', timestamp: Date.now() - 60000},
          2: {
            username: 'Bob',
            text: 'Hi there!',
            timestamp: Date.now() - 30000,
          },
        },
      },
      {},
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/Input.jsx": "import './input.css';

export const Input = ({
  value,
  onChange,
  placeholder = '',
  autoFocus = false,
}) => (
  <input
    type="text"
    value={value}
    onChange={(e) => onChange(e.target.value)}
    placeholder={placeholder}
    autoFocus={autoFocus}
  />
);
",
  "client/src/Message.jsx": "import {useRow, STORE_ID} from './ChatStore';
import './message.css';

export const Message = ({rowId}) => {
  const row = useRow('messages', rowId, 'chat');
  const time = new Date(row.timestamp).toLocaleTimeString();

  return (
    <div className="message">
      <span className="username">{row.username}:</span>
      <span className="text">{row.text}</span>
      <span className="time">{time}</span>
    </div>
  );
};
",
  "client/src/MessageInput.jsx": "import {useState} from 'react';
import {useAddRowCallback, STORE_ID as CHAT_STORE_ID} from './ChatStore';
import {useValue, STORE_ID as SETTINGS_STORE_ID} from './SettingsStore';
import './messageInput.css';
import {Button} from './Button';
import {Input} from './Input';

export const MessageInput = () => {
  const [message, setMessage] = useState('');
  const username = useValue('username', SETTINGS_STORE_ID) || 'Anonymous';

  const handleSend = useAddRowCallback(
    'messages',
    () => ({
      username,
      text: message,
      timestamp: Date.now(),
    }),
    [message, username],
    CHAT_STORE_ID,
  );

  const onSubmit = (e) => {
    e.preventDefault();
    if (message.trim()) {
      handleSend();
      setMessage('');
    }
  };

  return (
    <form onSubmit={onSubmit} id="messageInput">
      <Input
        value={message}
        onChange={setMessage}
        placeholder="Type a message..."
        autoFocus
      />
      <Button type="submit" variant="primary">
        Send
      </Button>
    </form>
  );
};
",
  "client/src/Messages.jsx": "import {useMemo} from 'react';
import {useRowIds, useStore, STORE_ID} from './ChatStore';
import './messages.css';
import {Message} from './Message';

export const Messages = () => {
  const store = useStore(STORE_ID);
  const messageIds = useRowIds('messages', STORE_ID);

  const sortedIds = useMemo(() => {
    return [...messageIds].sort((a, b) => {
      const rowA = store.getRow('messages', a);
      const rowB = store.getRow('messages', b);
      return rowA.timestamp - rowB.timestamp;
    });
  }, [messageIds, store]);

  return (
    <div id="messages">
      {sortedIds.map((id) => (
        <Message key={id} rowId={id} />
      ))}
    </div>
  );
};
",
  "client/src/SettingsStore.jsx": "import {createStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useValue,
  useSetValueCallback,
} from 'tinybase/ui-react';

export const STORE_ID = 'settings';

export {useValue, useSetValueCallback};

export const SettingsStore = () => {
  const store = useCreateStore(() =>
    createStore().setValue('username', 'Carol'),
  );

  useProvideStore(STORE_ID, store);

  return null;
};
",
  "client/src/UsernameInput.jsx": "import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';
import './usernameInput.css';
import {Input} from './Input';

export const UsernameInput = () => {
  const username = useValue('username', STORE_ID) || '';
  const setUsername = useSetValueCallback('username', (_e) => _e, [], STORE_ID);

  return (
    <div id="usernameInput">
      <label>Your name:</label>
      <Input
        value={username}
        onChange={setUsername}
        placeholder="Enter your name"
      />
    </div>
  );
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.jsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')).render(<App />);
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/message.css": ".message {
  margin-bottom: 0.75rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.message .username {
  font-weight: 800;
  color: #d81b60;
}

.message .text {
  flex: 1;
}

.message .time {
  font-size: 0.8rem;
  color: #666;
}
",
  "client/src/messageInput.css": "#messageInput {
  display: flex;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid var(--border);
}
",
  "client/src/messages.css": "#messages {
  overflow-y: auto;
  padding: 1rem 0;
  height: 400px;
  margin-bottom: 1rem;
}
",
  "client/src/usernameInput.css": "#usernameInput {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

#usernameInput label {
  white-space: nowrap;
}

#usernameInput input {
  flex: 1;
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > js-react-drawing > should match snapshot 1`] = `
{
  "README.md": "# test-js-react-drawing

A TinyBase app built with JavaScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Drawing</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Drawing</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A collaborative drawing canvas showcasing TinyBase's state
              synchronization.
              <br /><br />
              Built with JavaScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.jsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-react-drawing",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.jsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {SettingsStore} from './SettingsStore';
import {CanvasStore} from './CanvasStore';
import {DrawingControls} from './DrawingControls';
import {Canvas} from './Canvas';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <SettingsStore />
        <CanvasStore />
        <DrawingControls />
        <Canvas />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/BrushSize.jsx": "import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';
import './brushSize.css';

export const BrushSize = () => {
  const size = useValue('brushSize', STORE_ID) ?? 5;

  const setSize = useSetValueCallback(
    'brushSize',
    (e) => parseInt(e.target.value),
    [],
    STORE_ID,
  );

  return (
    <div id="brushSize">
      <label>Size:</label>
      <input type="range" min="1" max="50" value={size} onChange={setSize} />
      <span id="brushSizeValue">{size}</span>
    </div>
  );
};
",
  "client/src/Button.jsx": "import './button.css';
import {ReactNode} from 'react';

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Canvas.jsx": "import {useCallback, useEffect, useRef} from 'react';
import {useTable, useStore, STORE_ID as CANVAS_STORE_ID} from './CanvasStore';
import {useValues, STORE_ID as SETTINGS_STORE_ID} from './SettingsStore';
import {getUniqueId} from 'tinybase';
import './canvas.css';

export const Canvas = () => {
  const canvasRef = useRef(null);
  const isDrawing = useRef(false);
  const currentStrokeId = useRef(null);
  const pointIndex = useRef(0);
  const brush = useValues(SETTINGS_STORE_ID);
  const strokes = useTable('strokes', CANVAS_STORE_ID);
  const store = useStore(CANVAS_STORE_ID);

  const draw = useCallback(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    Object.entries(strokes).forEach(([id, stroke]) => {
      if (stroke) {
        const points = [];
        let i = 0;
        while (stroke[\`x\${i}\`] !== undefined && stroke[\`y\${i}\`] !== undefined) {
          points.push({x: stroke[\`x\${i}\`], y: stroke[\`y\${i}\`]});
          i++;
        }
        if (points.length > 0) {
          ctx.strokeStyle = stroke.color;
          ctx.lineWidth = stroke.size * 2;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.beginPath();
          ctx.moveTo(points[0].x, points[0].y);
          for (let i = 1; i < points.length; i++) {
            ctx.lineTo(points[i].x, points[i].y);
          }
          ctx.stroke();
        }
      }
    });
  }, [strokes]);
  useEffect(() => {
    draw();
  }, [draw]);

  const getPoint = (e) => {
    const canvas = canvasRef.current;
    if (!canvas) return null;

    const rect = canvas.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;

    return {
      x: clientX - rect.left,
      y: clientY - rect.top,
    };
  };

  const handleStart = (e) => {
    isDrawing.current = true;
    pointIndex.current = 0;
    currentStrokeId.current = getUniqueId();

    store.setRow('strokes', currentStrokeId.current, {
      color: brush.brushColor,
      size: brush.brushSize,
    });

    const point = getPoint(e.nativeEvent);
    if (point) {
      store.setCell('strokes', currentStrokeId.current, 'x0', point.x);
      store.setCell('strokes', currentStrokeId.current, 'y0', point.y);
      pointIndex.current = 1;
    }
  };

  const handleMove = (e) => {
    if (isDrawing.current && currentStrokeId.current) {
      const point = getPoint(e.nativeEvent);
      if (point) {
        const idx = pointIndex.current;
        store.setCell('strokes', currentStrokeId.current, \`x\${idx}\`, point.x);
        store.setCell('strokes', currentStrokeId.current, \`y\${idx}\`, point.y);
        pointIndex.current++;
      }
    }
  };

  const handleEnd = () => {
    isDrawing.current = false;
    currentStrokeId.current = null;
    pointIndex.current = 0;
  };

  return (
    <canvas
      ref={canvasRef}
      width={600}
      height={400}
      id="drawingCanvas"
      onMouseDown={handleStart}
      onMouseMove={handleMove}
      onMouseUp={handleEnd}
      onMouseLeave={handleEnd}
      onTouchStart={handleStart}
      onTouchMove={handleMove}
      onTouchEnd={handleEnd}
    />
  );
};
",
  "client/src/CanvasStore.jsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useAddRowCallback,
  useDelTableCallback,
  useRow,
  useRowIds,
  useStore,
  useTable,
} from 'tinybase/ui-react';
import {getUniqueId} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
export const STORE_ID = 'canvas';

export {
  useAddRowCallback,
  useDelTableCallback,
  useRow,
  useRowIds,
  useStore,
  useTable,
};

export const CanvasStore = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([{strokes: {}}, {}]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/ColorPicker.jsx": "import './colorPicker.css';
import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';

export const ColorPicker = () => {
  const colors = [
    '#d81b60',
    '#1976d2',
    '#388e3c',
    '#f57c00',
    '#7b1fa2',
    '#fff',
  ];
  const currentColor = useValue('brushColor', STORE_ID);

  const setColor = useSetValueCallback(
    'brushColor',
    (color) => color,
    [],
    STORE_ID,
  );

  return (
    <div id="colorPicker">
      {colors.map((color) => (
        <button
          key={color}
          className={\`colorBtn\${currentColor === color ? ' active' : ''}\`}
          style={{background: color}}
          onClick={() => setColor(color)}
        />
      ))}
    </div>
  );
};
",
  "client/src/DrawingControls.jsx": "import './drawingControls.css';
import {useDelTableCallback, STORE_ID} from './CanvasStore';
import {Button} from './Button';
import {ColorPicker} from './ColorPicker';
import {BrushSize} from './BrushSize';

export const DrawingControls = () => {
  const clearStrokes = useDelTableCallback('strokes', () => null, [], STORE_ID);

  return (
    <div id="drawingControls">
      <ColorPicker />
      <BrushSize />
      <Button onClick={clearStrokes} variant="primary">
        Clear
      </Button>
    </div>
  );
};
",
  "client/src/SettingsStore.jsx": "import {createStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useValue,
  useSetValueCallback,
  useValues,
} from 'tinybase/ui-react';

export const STORE_ID = 'settings';

export {useValue, useSetValueCallback, useValues};

export const SettingsStore = () => {
  const store = useCreateStore(() =>
    createStore().setValue('brushColor', '#d81b60').setValue('brushSize', 5),
  );

  useProvideStore(STORE_ID, store);

  return null;
};
",
  "client/src/brushSize.css": "#brushSize {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

#brushSize label {
  white-space: nowrap;
}

#brushSize input {
  width: 100px;
  vertical-align: middle;
}

#brushSizeValue {
  width: 2rem;
  min-width: 2rem;
  text-align: center;
  display: inline-block;
}
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/canvas.css": "#drawingCanvas {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  cursor: crosshair;
  display: block;
  touch-action: none;
  margin: 0 auto;
}
",
  "client/src/colorPicker.css": "#colorPicker {
  display: flex;
  gap: 0;
  align-items: center;
}

.colorBtn {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--border);
  border-radius: 0.25rem;
  cursor: pointer;
  transition: border-color 0.2s;
  margin: 0 0 0 0.5rem;
  padding: 0;
}

.colorBtn:hover,
.colorBtn.active {
  border-color: var(--accent);
}
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/drawingControls.css": "#drawingControls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;
  margin: 0 auto 1rem;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  justify-content: space-between;
  max-width: 600px;
}
",
  "client/src/index.jsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')).render(<App />);
});
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > js-react-game > should match snapshot 1`] = `
{
  "README.md": "# test-js-react-game

A TinyBase app built with JavaScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Game</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Game</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A tic-tac-toe game demonstrating turn-based logic and computed
              game state.
              <br /><br />
              Built with JavaScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.jsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-react-game",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.jsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {Store} from './Store';
import {Game} from './Game';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <Store />
        <Game />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Board.jsx": "import './board.css';
import {useMemo} from 'react';
import {useValue, STORE_ID} from './Store';
import {Square} from './Square';

export const Board = () => {
  const gameStatus = useValue('gameStatus', STORE_ID);
  const winningLine = useValue('winningLine', STORE_ID);

  const winningPositions = useMemo(() => {
    if (!winningLine) return new Set();
    return new Set(winningLine.split(',').map(Number));
  }, [winningLine]);

  const disabled = gameStatus !== 'playing';

  return (
    <div id="board">
      {Array.from({length: 9}, (_, i) => (
        <Square
          key={i}
          position={i}
          disabled={disabled}
          winning={winningPositions.has(i)}
        />
      ))}
    </div>
  );
};
",
  "client/src/Button.jsx": "import './button.css';
import {ReactNode} from 'react';

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Game.jsx": "import {
  useStore,
  useSetValuesCallback,
  useTableListener,
  STORE_ID,
} from './Store';
import {Button} from './Button';
import {Board} from './Board';
import {GameStatus} from './GameStatus';

const WINNING_LINES = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6],
];

export const Game = () => {
  const store = useStore(STORE_ID);

  useTableListener(
    'board',
    () => {
      const gameStatus = store.getValue('gameStatus');
      if (gameStatus !== 'playing') return;

      const board = store.getTable('board');

      for (const line of WINNING_LINES) {
        const [a, b, c] = line;
        const cellA = board[a]?.value;
        const cellB = board[b]?.value;
        const cellC = board[c]?.value;

        if (cellA && cellA === cellB && cellA === cellC) {
          store.setValue('gameStatus', 'won');
          store.setValue('winner', cellA);
          store.setValue('winningLine', line.join(','));
          return;
        }
      }

      const filledCells = Object.values(board).filter(
        (cell) => cell.value,
      ).length;
      if (filledCells === 9) {
        store.setValue('gameStatus', 'draw');
        return;
      }

      const currentPlayer = store.getValue('currentPlayer');
      store.setValue('currentPlayer', currentPlayer === 'X' ? 'O' : 'X');
    },
    [],
    true,
    STORE_ID,
  );

  const resetGame = useSetValuesCallback(() => {
    store.delTable('board');
    return {currentPlayer: 'X', gameStatus: 'playing'};
  }, []);

  return (
    <>
      <GameStatus />
      <Board />
      <div style={{textAlign: 'center', marginTop: '2rem'}}>
        <Button onClick={resetGame} variant="primary">
          New Game
        </Button>
      </div>
    </>
  );
};
",
  "client/src/GameStatus.jsx": "import './gameStatus.css';
import {useValue, STORE_ID} from './Store';

export const GameStatus = () => {
  const gameStatus = useValue('gameStatus', STORE_ID);
  const currentPlayer = useValue('currentPlayer', STORE_ID);
  const winner = useValue('winner', STORE_ID);

  return (
    <div id="gameStatus">
      {gameStatus === 'playing' && (
        <>
          Player <span className="player">{currentPlayer}</span>'s turn
        </>
      )}
      {gameStatus === 'won' && (
        <>
          Player <span className="winner">{winner}</span> wins!
        </>
      )}
      {gameStatus === 'draw' && <>It's a draw!</>}
    </div>
  );
};
",
  "client/src/Square.jsx": "import './square.css';
import {useCell, useStore, useValue, STORE_ID} from './Store';

export const Square = ({position, disabled, winning}) => {
  const store = useStore(STORE_ID);
  const value = useCell('board', position.toString(), 'value', STORE_ID);
  const currentPlayer = useValue('currentPlayer', STORE_ID);

  const isDisabled = disabled || !!value;

  const handleClick = () => {
    if (!isDisabled) {
      store.setCell('board', position.toString(), 'value', currentPlayer);
    }
  };

  return (
    <button
      className={\`square\${isDisabled ? ' disabled' : ''}\${winning ? ' winning' : ''}\`}
      onClick={handleClick}
      disabled={isDisabled}
    >
      {value || ''}
    </button>
  );
};
",
  "client/src/Store.jsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useStore,
  useSetValuesCallback,
  useTableListener,
  useCell,
  useValue,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
export const STORE_ID = 'game';

export {useStore, useSetValuesCallback, useTableListener, useCell, useValue};

export const Store = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([
      {},
      {
        currentPlayer: 'X',
        gameStatus: 'playing',
      },
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/board.css": "#board {
  display: grid;
  grid-template-columns: repeat(3, 100px);
  grid-template-rows: repeat(3, 100px);
  gap: 1px;
  background: var(--border);
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  overflow: hidden;
  margin: 0 auto 2rem;
  width: fit-content;
  padding: 1px;
}
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/gameStatus.css": "#gameStatus {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 800;
  margin: 2rem 0 1rem;
  color: var(--accent);
}

#gameStatus .winner {
  color: var(--accent);
  animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}
",
  "client/src/index.jsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')).render(<App />);
});
",
  "client/src/square.css": ".square {
  width: 100px;
  height: 100px;
  background: var(--bg2);
  border: none;
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
}

.square:hover:not(.square.disabled) {
  background: var(--bg);
  outline: 2px solid var(--accent);
  outline-offset: -2px;
  z-index: 1;
  position: relative;
}

.square:disabled {
  cursor: not-allowed;
}

.square.disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.square.winning {
  background: var(--accent);
  color: var(--bg);
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > js-react-todos > should match snapshot 1`] = `
{
  "README.md": "# test-js-react-todos

A TinyBase app built with JavaScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Todos</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Todos</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A simple todo list application demonstrating TinyBase's reactive
              data management with CRUD operations.
              <br /><br />
              Built with JavaScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.jsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-react-todos",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.jsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {Store} from './Store';
import {TodoInput} from './TodoInput';
import {TodoList} from './TodoList';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <Store />
        <TodoInput />
        <TodoList />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Button.jsx": "import './button.css';
import {ReactNode} from 'react';

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Input.jsx": "import './input.css';

export const Input = ({
  value,
  onChange,
  placeholder = '',
  autoFocus = false,
}) => (
  <input
    type="text"
    value={value}
    onChange={(e) => onChange(e.target.value)}
    placeholder={placeholder}
    autoFocus={autoFocus}
  />
);
",
  "client/src/Store.jsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateMergeableStore,
  useProvideStore,
  useAddRowCallback,
  useDelRowCallback,
  useRow,
  useRowIds,
  useSetPartialRowCallback,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
export {
  useAddRowCallback,
  useDelRowCallback,
  useRow,
  useRowIds,
  useSetPartialRowCallback,
};

export const STORE_ID = 'todos';

export const Store = () => {
  const store = useCreateMergeableStore(() =>
    createMergeableStore().setDefaultContent([
      {
        todos: {
          1: {text: 'Learn TinyBase', completed: false},
          2: {text: 'Build an app', completed: false},
        },
      },
      {},
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/TodoInput.jsx": "import './todoInput.css';
import {useState} from 'react';
import {useAddRowCallback, STORE_ID} from './Store';
import {Button} from './Button';
import {Input} from './Input';

export const TodoInput = () => {
  const [text, setText] = useState('');
  const addRow = useAddRowCallback(
    'todos',
    () => ({text, completed: false}),
    [text],
    STORE_ID,
  );

  const handleSubmit = (e) => {
    e.preventDefault();
    if (text.trim()) {
      addRow();
      setText('');
    }
  };

  return (
    <form id="todoInput" onSubmit={handleSubmit}>
      <Input
        value={text}
        onChange={setText}
        placeholder="What needs to be done?"
        autoFocus
      />
      <Button type="submit" variant="primary">
        Add
      </Button>
    </form>
  );
};
",
  "client/src/TodoItem.jsx": "import './todoItem.css';
import {
  useDelRowCallback,
  useRow,
  useSetPartialRowCallback,
  STORE_ID,
} from './Store';
import {Button} from './Button';

export const TodoItem = ({rowId}) => {
  const todo = useRow('todos', rowId, STORE_ID);
  const setPartialRow = useSetPartialRowCallback(
    'todos',
    rowId,
    (e) => ({completed: e.target.checked}),
    [],
    STORE_ID,
  );
  const delRow = useDelRowCallback('todos', rowId, STORE_ID);

  return (
    <div className={\`todoItem\${todo.completed ? ' completed' : ''}\`}>
      <input
        type="checkbox"
        checked={todo.completed}
        onChange={setPartialRow}
        id={\`todo-\${rowId}\`}
      />
      <label htmlFor={\`todo-\${rowId}\`}>{todo.text}</label>
      <Button onClick={delRow}>Delete</Button>
    </div>
  );
};
",
  "client/src/TodoList.jsx": "import './todoList.css';
import {useRowIds, STORE_ID} from './Store';
import {TodoItem} from './TodoItem';

export const TodoList = () => {
  const todoIds = useRowIds('todos', STORE_ID);

  return (
    <div id="todoList">
      {todoIds.map((id) => (
        <TodoItem key={id} rowId={id} />
      ))}
    </div>
  );
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.jsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')).render(<App />);
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/todoInput.css": "#todoInput {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

#todoInput input {
  flex: 1;
}
",
  "client/src/todoItem.css": ".todoItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
}

.todoItem:last-child {
  border-bottom: none;
}

.todoItem input[type='checkbox'] {
  width: 1.25rem;
  height: 1.25rem;
  cursor: pointer;
  flex-shrink: 0;
}

.todoItem label {
  flex: 1;
  cursor: pointer;
  user-select: none;
}

.todoItem.completed label {
  text-decoration: line-through;
  opacity: 0.6;
}

.todoItem button {
  flex-shrink: 0;
}
",
  "client/src/todoList.css": "#todoList {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  overflow: hidden;
  background: var(--bg2);
}

#todoList:empty::before {
  content: 'No todos yet. Add one above!';
  display: block;
  padding: 2rem;
  text-align: center;
  color: var(--fg2);
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > js-vanilla-chat > should match snapshot 1`] = `
{
  "README.md": "# test-js-vanilla-chat

A TinyBase app built with JavaScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Chat</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Chat</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A real-time chat application demonstrating TinyBase's reactive
              data management.
              <br /><br />
              Built with JavaScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.js"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-vanilla-chat",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.js": "import {settingsStore} from './settingsStore';
import {chatStore} from './chatStore';
import {createButton} from './button';
import {createInput} from './input';
import {createMessage} from './message';
import {createMessages} from './messages';
import {createUsernameInput} from './usernameInput';
import {createMessageInput} from './messageInput';

export const app = () => {
  const appContainer = document.getElementById('app');

  appContainer.appendChild(createUsernameInput(settingsStore, chatStore));
  appContainer.appendChild(createMessages(chatStore));

  const messageInputContainer = createMessageInput(settingsStore, chatStore);
  appContainer.appendChild(messageInputContainer);

  const messageInput = messageInputContainer.querySelector('input');
  messageInput.focus();
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.js": "import './button.css';

export const createButton = (text, onClick, variant = 'default') => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/chatStore.js": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const chatStore = createMergeableStore().setDefaultContent([
  {
    messages: {
      1: {username: 'Alice', text: 'Hello!', timestamp: Date.now() - 60000},
      2: {username: 'Bob', text: 'Hi there!', timestamp: Date.now() - 30000},
    },
  },
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  chatStore,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.js": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/input.js": "import './input.css';

export const createInput = (placeholder = '', value = '', onInput) => {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = placeholder;
  input.value = value;
  if (onInput) {
    input.addEventListener('input', () => onInput(input.value));
  }
  return input;
};
",
  "client/src/message.css": ".message {
  margin-bottom: 0.75rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.message .username {
  font-weight: 800;
  color: #d81b60;
}

.message .text {
  flex: 1;
}

.message .time {
  font-size: 0.8rem;
  color: #666;
}
",
  "client/src/message.js": "import './message.css';

export const createMessage = (username, text, timestamp) => {
  const time = new Date(timestamp).toLocaleTimeString();

  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';

  const usernameSpan = document.createElement('span');
  usernameSpan.className = 'username';
  usernameSpan.textContent = \`\${username}:\`;

  const textSpan = document.createElement('span');
  textSpan.className = 'text';
  textSpan.textContent = text;

  const timeSpan = document.createElement('span');
  timeSpan.className = 'time';
  timeSpan.textContent = time;

  messageDiv.appendChild(usernameSpan);
  messageDiv.appendChild(textSpan);
  messageDiv.appendChild(timeSpan);

  return messageDiv;
};
",
  "client/src/messageInput.css": "#messageInput {
  display: flex;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid var(--border);
}
",
  "client/src/messageInput.js": "import './messageInput.css';
import {} from './settingsStore';
import {} from './chatStore';
import {createButton} from './button';
import {createInput} from './input';

export const createMessageInput = (settingsStore, chatStore) => {
  const messageInputContainer = document.createElement('div');
  messageInputContainer.id = 'messageInput';

  const messageInput = createInput('Type a message...');
  messageInputContainer.appendChild(messageInput);

  const sendMessage = () => {
    const text = messageInput.value.trim();
    if (text) {
      chatStore.addRow('messages', {
        username: settingsStore.getValue('username'),
        text,
        timestamp: Date.now(),
      });
      messageInput.value = '';
      messageInput.focus();
    }
  };

  messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      sendMessage();
    }
  });

  const sendButton = createButton('Send', sendMessage, 'primary');
  messageInputContainer.appendChild(sendButton);

  return messageInputContainer;
};
",
  "client/src/messages.css": "#messages {
  overflow-y: auto;
  padding: 1rem 0;
  height: 400px;
  margin-bottom: 1rem;
}
",
  "client/src/messages.js": "import './messages.css';
import {} from './chatStore';
import {createMessage} from './message';

export const createMessages = (store) => {
  const messagesContainer = document.createElement('div');
  messagesContainer.id = 'messages';

  const updateMessages = () => {
    const messageRows = store.getTable('messages');
    const sortedIds = Object.keys(messageRows).sort(
      (a, b) => messageRows[a].timestamp - messageRows[b].timestamp,
    );

    messagesContainer.innerHTML = '';
    sortedIds.forEach((id) => {
      const msg = messageRows[id];
      const messageElement = createMessage(
        msg.username,
        msg.text,
        msg.timestamp,
      );
      messagesContainer.appendChild(messageElement);
    });
  };

  updateMessages();

  store.addTablesListener(updateMessages);

  return messagesContainer;
};
",
  "client/src/settingsStore.js": "import {createStore} from 'tinybase';

export const settingsStore = createStore().setValue('username', 'Carol');
",
  "client/src/usernameInput.css": "#usernameInput {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

#usernameInput label {
  white-space: nowrap;
}

#usernameInput input {
  flex: 1;
}
",
  "client/src/usernameInput.js": "import './usernameInput.css';
import {} from './settingsStore';
import {} from './chatStore';
import {createInput} from './input';

export const createUsernameInput = (settingsStore, chatStore) => {
  const container = document.createElement('div');
  container.id = 'usernameInput';

  const label = document.createElement('label');
  label.textContent = 'Your name:';

  const usernameInput = createInput(
    'Enter your name',
    settingsStore.getValue('username'),
  );

  container.appendChild(label);
  container.appendChild(usernameInput);

  usernameInput.addEventListener('input', () => {
    settingsStore.setValue('username', usernameInput.value);
  });

  settingsStore.addValuesListener(() => {
    usernameInput.value = settingsStore.getValue('username');
  });

  return container;
};
",
}
`;

exports[`create-tinybase > js-vanilla-drawing > should match snapshot 1`] = `
{
  "README.md": "# test-js-vanilla-drawing

A TinyBase app built with JavaScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Drawing</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Drawing</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A collaborative drawing canvas showcasing TinyBase's state
              synchronization.
              <br /><br />
              Built with JavaScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.js"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-vanilla-drawing",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.js": "import {settingsStore} from './settingsStore';
import {canvasStore} from './canvasStore';
import {createDrawingControls} from './drawingControls';
import {createCanvas} from './canvas';

export const app = () => {
  const appContainer = document.getElementById('app');

  appContainer.appendChild(createDrawingControls(settingsStore, canvasStore));
  appContainer.appendChild(createCanvas(settingsStore, canvasStore));
};
",
  "client/src/brushSize.css": "#brushSize {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

#brushSize label {
  white-space: nowrap;
}

#brushSize input {
  width: 100px;
  vertical-align: middle;
}

#brushSizeValue {
  width: 2rem;
  min-width: 2rem;
  text-align: center;
  display: inline-block;
}
",
  "client/src/brushSize.js": "import './brushSize.css';
export const createBrushSize = (store) => {
  const container = document.createElement('div');
  container.id = 'brushSize';

  const label = document.createElement('label');
  label.textContent = 'Size:';

  const sizeSlider = document.createElement('input');
  sizeSlider.type = 'range';
  sizeSlider.min = '1';
  sizeSlider.max = '50';
  sizeSlider.value = '5';

  const sizeLabel = document.createElement('span');
  sizeLabel.id = 'brushSizeValue';
  sizeLabel.textContent = '5';

  sizeSlider.addEventListener('input', () => {
    const size = parseInt(sizeSlider.value);
    store.setValue('brushSize', size);
    sizeLabel.textContent = \`\${size}\`;
  });

  container.appendChild(label);
  container.appendChild(sizeSlider);
  container.appendChild(sizeLabel);

  return container;
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.js": "import './button.css';

export const createButton = (text, onClick, variant = 'default') => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/canvas.css": "#drawingCanvas {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  cursor: crosshair;
  display: block;
  touch-action: none;
  margin: 0 auto;
}
",
  "client/src/canvas.js": "import './canvas.css';
import {getUniqueId} from 'tinybase';
export const createCanvas = (settingsStore, canvasStore) => {
  const canvas = document.createElement('canvas');
  canvas.id = 'drawingCanvas';
  canvas.width = 600;
  canvas.height = 400;

  const ctx = canvas.getContext('2d');
  let isDrawing = false;
  let currentStrokeId = null;
  let pointIndex = 0;

  const draw = () => {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const strokes = canvasStore.getTable('strokes');
    Object.entries(strokes).forEach(([id, stroke]) => {
      const points = [];
      let i = 0;
      while (stroke[\`x\${i}\`] !== undefined && stroke[\`y\${i}\`] !== undefined) {
        points.push({x: stroke[\`x\${i}\`], y: stroke[\`y\${i}\`]});
        i++;
      }
      if (points.length > 0) {
        ctx.strokeStyle = stroke.color;
        ctx.lineWidth = stroke.size * 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        for (let i = 1; i < points.length; i++) {
          ctx.lineTo(points[i].x, points[i].y);
        }
        ctx.stroke();
      }
    });
  };
  const addPoint = (e) => {
    if (!currentStrokeId) return;

    const rect = canvas.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;

    canvasStore.setCell(
      'strokes',
      currentStrokeId,
      \`x\${pointIndex}\`,
      clientX - rect.left,
    );
    canvasStore.setCell(
      'strokes',
      currentStrokeId,
      \`y\${pointIndex}\`,
      clientY - rect.top,
    );
    pointIndex++;
  };

  const startStroke = (e) => {
    const brush = settingsStore.getValues();
    currentStrokeId = getUniqueId();
    pointIndex = 0;

    canvasStore.setRow('strokes', currentStrokeId, {
      color: brush.brushColor,
      size: brush.brushSize,
    });

    addPoint(e);
  };

  canvas.addEventListener('mousedown', (e) => {
    isDrawing = true;
    startStroke(e);
  });

  canvas.addEventListener('mouseup', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvas.addEventListener('mouseleave', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvas.addEventListener('mousemove', (e) => {
    if (isDrawing) addPoint(e);
  });

  canvas.addEventListener('touchstart', (e) => {
    isDrawing = true;
    startStroke(e);
    e.preventDefault();
  });

  canvas.addEventListener('touchmove', (e) => {
    if (isDrawing) {
      addPoint(e);
      e.preventDefault();
    }
  });

  canvas.addEventListener('touchend', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvasStore.addTablesListener(draw);
  draw();

  return canvas;
};
",
  "client/src/canvasStore.js": "import {createMergeableStore} from 'tinybase';
import {getUniqueId} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const canvasStore = createMergeableStore().setDefaultContent([
  {strokes: {}},
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  canvasStore,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});
",
  "client/src/colorPicker.css": "#colorPicker {
  display: flex;
  gap: 0;
  align-items: center;
}

.colorBtn {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--border);
  border-radius: 0.25rem;
  cursor: pointer;
  transition: border-color 0.2s;
  margin: 0 0 0 0.5rem;
  padding: 0;
}

.colorBtn:hover,
.colorBtn.active {
  border-color: var(--accent);
}
",
  "client/src/colorPicker.js": "import './colorPicker.css';
export const createColorPicker = (store) => {
  const colors = [
    '#d81b60',
    '#1976d2',
    '#388e3c',
    '#f57c00',
    '#7b1fa2',
    '#fff',
  ];
  const container = document.createElement('div');
  container.id = 'colorPicker';

  const buttons = [];

  colors.forEach((color) => {
    const btn = document.createElement('button');
    btn.className = 'colorBtn';
    btn.style.background = color;
    btn.addEventListener('click', () => {
      store.setValue('brushColor', color);
    });
    container.appendChild(btn);
    buttons.push(btn);
  });

  const updateActive = () => {
    const currentColor = store.getValue('brushColor');
    buttons.forEach((btn, i) => {
      btn.classList.toggle('active', colors[i] === currentColor);
    });
  };

  store.addValueListener('brushColor', updateActive);
  updateActive();

  return container;
};
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/drawingControls.css": "#drawingControls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;
  margin: 0 auto 1rem;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  justify-content: space-between;
  max-width: 600px;
}
",
  "client/src/drawingControls.js": "import './drawingControls.css';
import {createButton} from './button';
import {createColorPicker} from './colorPicker';
import {createBrushSize} from './brushSize';

export const createDrawingControls = (settingsStore, canvasStore) => {
  const controls = document.createElement('div');
  controls.id = 'drawingControls';

  controls.appendChild(createColorPicker(settingsStore));
  controls.appendChild(createBrushSize(settingsStore));

  const clearButton = createButton(
    'Clear',
    () => canvasStore.delTable('strokes'),
    'primary',
  );
  controls.appendChild(clearButton);

  return controls;
};
",
  "client/src/index.js": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/settingsStore.js": "import {createStore} from 'tinybase';

export const settingsStore = createStore()
  .setValue('brushColor', '#d81b60')
  .setValue('brushSize', 5);
",
}
`;

exports[`create-tinybase > js-vanilla-game > should match snapshot 1`] = `
{
  "README.md": "# test-js-vanilla-game

A TinyBase app built with JavaScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Game</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Game</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A tic-tac-toe game demonstrating turn-based logic and computed
              game state.
              <br /><br />
              Built with JavaScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.js"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-vanilla-game",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.js": "import {store} from './store';
import {createGame} from './game';

export const app = () => {
  const appContainer = document.getElementById('app');
  appContainer.appendChild(createGame(store));
};
",
  "client/src/board.css": "#board {
  display: grid;
  grid-template-columns: repeat(3, 100px);
  grid-template-rows: repeat(3, 100px);
  gap: 1px;
  background: var(--border);
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  overflow: hidden;
  margin: 0 auto 2rem;
  width: fit-content;
  padding: 1px;
}
",
  "client/src/board.js": "import './board.css';
import {createSquare} from './square';

export const createBoard = (store) => {
  const board = document.createElement('div');
  board.id = 'board';

  const render = () => {
    const gameStatus = store.getValue('gameStatus');
    const winningLine = store.getValue('winningLine');
    const currentPlayer = store.getValue('currentPlayer');
    const winningPositions = new Set(
      winningLine ? winningLine.split(',').map(Number) : [],
    );
    const disabled = gameStatus !== 'playing';

    board.innerHTML = '';
    for (let i = 0; i < 9; i++) {
      const cell = store.getCell('board', i.toString(), 'value');
      const square = createSquare(
        i,
        cell,
        () => {
          if (gameStatus === 'playing' && !cell) {
            store.setCell('board', i.toString(), 'value', currentPlayer);
          }
        },
        disabled || !!cell,
        winningPositions.has(i),
      );
      board.appendChild(square);
    }
  };

  store.addValuesListener(render);
  store.addTableListener('board', render);
  render();

  return board;
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.js": "import './button.css';

export const createButton = (text, onClick, variant = 'default') => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/game.js": "import {createButton} from './button';
import {createBoard} from './board';
import {createGameStatus} from './gameStatus';

const WINNING_LINES = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6],
];

export const createGame = (store) => {
  const checkGameState = () => {
    const gameStatus = store.getValue('gameStatus');
    if (gameStatus !== 'playing') return;

    const board = store.getTable('board');

    for (const line of WINNING_LINES) {
      const [a, b, c] = line;
      const cellA = board[a]?.value;
      const cellB = board[b]?.value;
      const cellC = board[c]?.value;

      if (cellA && cellA === cellB && cellA === cellC) {
        store.setValue('gameStatus', 'won');
        store.setValue('winner', cellA);
        store.setValue('winningLine', line.join(','));
        return;
      }
    }

    const filledCells = Object.values(board).filter(
      (cell) => cell.value,
    ).length;
    if (filledCells === 9) {
      store.setValue('gameStatus', 'draw');
      return;
    }

    const currentPlayer = store.getValue('currentPlayer');
    store.setValue('currentPlayer', currentPlayer === 'X' ? 'O' : 'X');
  };

  store.addTableListener('board', checkGameState, true);

  const resetGame = () => {
    store.delTable('board');
    store.setValues({
      currentPlayer: 'X',
      gameStatus: 'playing',
    });
  };

  const gameContainer = document.createElement('div');

  gameContainer.appendChild(createGameStatus(store));
  gameContainer.appendChild(createBoard(store));

  const buttonContainer = document.createElement('div');
  buttonContainer.style.textAlign = 'center';
  buttonContainer.style.marginTop = '2rem';
  buttonContainer.appendChild(createButton('New Game', resetGame, 'primary'));
  gameContainer.appendChild(buttonContainer);

  return gameContainer;
};
",
  "client/src/gameStatus.css": "#gameStatus {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 800;
  margin: 2rem 0 1rem;
  color: var(--accent);
}

#gameStatus .winner {
  color: var(--accent);
  animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}
",
  "client/src/gameStatus.js": "import './gameStatus.css';
export const createGameStatus = (store) => {
  const status = document.createElement('div');
  status.id = 'gameStatus';

  const render = () => {
    const gameStatus = store.getValue('gameStatus');
    const currentPlayer = store.getValue('currentPlayer');
    const winner = store.getValue('winner');

    if (gameStatus === 'playing') {
      status.innerHTML = \`Player <span class="player">\${currentPlayer}</span>'s turn\`;
    } else if (gameStatus === 'won') {
      status.innerHTML = \`Player <span class="winner">\${winner}</span> wins!\`;
    } else if (gameStatus === 'draw') {
      status.textContent = "It's a draw!";
    }
  };

  store.addValuesListener(render);
  render();

  return status;
};
",
  "client/src/index.js": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/square.css": ".square {
  width: 100px;
  height: 100px;
  background: var(--bg2);
  border: none;
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
}

.square:hover:not(.square.disabled) {
  background: var(--bg);
  outline: 2px solid var(--accent);
  outline-offset: -2px;
  z-index: 1;
  position: relative;
}

.square:disabled {
  cursor: not-allowed;
}

.square.disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.square.winning {
  background: var(--accent);
  color: var(--bg);
}
",
  "client/src/square.js": "import './square.css';

export const createSquare = (position, value, onClick, disabled, winning) => {
  const square = document.createElement('button');
  square.className = \`square\${disabled ? ' disabled' : ''}\${winning ? ' winning' : ''}\`;
  square.textContent = value || '';
  square.disabled = disabled;
  square.addEventListener('click', onClick);
  return square;
};
",
  "client/src/store.js": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const store = createMergeableStore().setDefaultContent([
  {},
  {
    currentPlayer: 'X',
    gameStatus: 'playing',
  },
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});
",
}
`;

exports[`create-tinybase > js-vanilla-todos > should match snapshot 1`] = `
{
  "README.md": "# test-js-vanilla-todos

A TinyBase app built with JavaScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Todos</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Todos</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A simple todo list application demonstrating TinyBase's reactive
              data management with CRUD operations.
              <br /><br />
              Built with JavaScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.js"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-js-vanilla-todos",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.js": "import {store} from './store';
import {createTodoInput} from './todoInput';
import {createTodoList} from './todoList';

export const app = () => {
  const appContainer = document.getElementById('app');

  const todoInputContainer = createTodoInput(store);
  appContainer.appendChild(todoInputContainer);

  const input = todoInputContainer.querySelector('input');
  input.focus();

  appContainer.appendChild(createTodoList(store));
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.js": "import './button.css';

export const createButton = (text, onClick, variant = 'default') => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/config.js": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.js": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/input.js": "import './input.css';

export const createInput = (placeholder = '', value = '', onInput) => {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = placeholder;
  input.value = value;
  if (onInput) {
    input.addEventListener('input', () => onInput(input.value));
  }
  return input;
};
",
  "client/src/store.js": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const store = createMergeableStore().setDefaultContent([
  {
    todos: {
      1: {text: 'Learn TinyBase', completed: false},
      2: {text: 'Build an app', completed: false},
    },
  },
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});
",
  "client/src/todoInput.css": "#todoInput {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

#todoInput input {
  flex: 1;
}
",
  "client/src/todoInput.js": "import './todoInput.css';
import {} from './store';
import {createButton} from './button';
import {createInput} from './input';

export const createTodoInput = (store) => {
  const container = document.createElement('div');
  container.id = 'todoInput';

  const input = createInput('What needs to be done?');

  const addTodo = () => {
    const text = input.value.trim();
    if (text) {
      store.addRow('todos', {text, completed: false});
      input.value = '';
      input.focus();
    }
  };

  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      addTodo();
    }
  });

  const addButton = createButton('Add', addTodo, 'primary');

  container.appendChild(input);
  container.appendChild(addButton);

  return container;
};
",
  "client/src/todoItem.css": ".todoItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
}

.todoItem:last-child {
  border-bottom: none;
}

.todoItem input[type='checkbox'] {
  width: 1.25rem;
  height: 1.25rem;
  cursor: pointer;
  flex-shrink: 0;
}

.todoItem label {
  flex: 1;
  cursor: pointer;
  user-select: none;
}

.todoItem.completed label {
  text-decoration: line-through;
  opacity: 0.6;
}

.todoItem button {
  flex-shrink: 0;
}
",
  "client/src/todoItem.js": "import './todoItem.css';
import {createButton} from './button';

export const createTodoItem = (id, text, completed, onToggle, onDelete) => {
  const item = document.createElement('div');
  item.className = \`todoItem\${completed ? ' completed' : ''}\`;

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.checked = completed;
  checkbox.id = \`todo-\${id}\`;
  checkbox.addEventListener('change', onToggle);

  const label = document.createElement('label');
  label.textContent = text;
  label.htmlFor = \`todo-\${id}\`;

  const deleteBtn = createButton('Delete', onDelete);

  item.appendChild(checkbox);
  item.appendChild(label);
  item.appendChild(deleteBtn);

  return item;
};
",
  "client/src/todoList.css": "#todoList {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  overflow: hidden;
  background: var(--bg2);
}

#todoList:empty::before {
  content: 'No todos yet. Add one above!';
  display: block;
  padding: 2rem;
  text-align: center;
  color: var(--fg2);
}
",
  "client/src/todoList.js": "import './todoList.css';
import {} from './store';
import {createTodoItem} from './todoItem';

export const createTodoList = (store) => {
  const list = document.createElement('div');
  list.id = 'todoList';

  const render = () => {
    const todos = store.getTable('todos');
    const todoIds = Object.keys(todos);

    list.innerHTML = '';
    todoIds.forEach((id) => {
      const todo = todos[id];
      const item = createTodoItem(
        id,
        todo.text,
        todo.completed,
        () => {
          store.setPartialRow('todos', id, {completed: !todo.completed});
        },
        () => {
          store.delRow('todos', id);
        },
      );
      list.appendChild(item);
    });
  };

  store.addTablesListener(render);
  render();

  return list;
};
",
}
`;

exports[`create-tinybase > ts-react-chat > should match snapshot 1`] = `
{
  "README.md": "# test-ts-react-chat

A TinyBase app built with TypeScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Chat</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Chat</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A real-time chat application demonstrating TinyBase's reactive
              data management.
              <br /><br />
              Built with TypeScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-react-chat",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.tsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {SettingsStore} from './SettingsStore';
import {ChatStore} from './ChatStore';
import {UsernameInput} from './UsernameInput';
import {Messages} from './Messages';
import {MessageInput} from './MessageInput';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <SettingsStore />
        <ChatStore />
        <UsernameInput />
        <Messages />
        <MessageInput />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Button.tsx": "import './button.css';
import {ReactNode} from 'react';

interface ButtonProps {
  children: ReactNode;
  onClick?: () => void;
  variant?: 'default' | 'primary';
  type?: 'button' | 'submit';
}

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}: ButtonProps) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/ChatStore.tsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useAddRowCallback,
  useRow,
  useRowIds,
  useStore,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
import type {MergeableStore} from 'tinybase';

export const STORE_ID = 'chat';

export {useAddRowCallback, useRow, useRowIds, useStore};

export const ChatStore = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([
      {
        messages: {
          '1': {
            username: 'Alice',
            text: 'Hello!',
            timestamp: Date.now() - 60000,
          },
          '2': {
            username: 'Bob',
            text: 'Hi there!',
            timestamp: Date.now() - 30000,
          },
        },
      },
      {},
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store: MergeableStore) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/Input.tsx": "import './input.css';

interface InputProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  autoFocus?: boolean;
}

export const Input = ({
  value,
  onChange,
  placeholder = '',
  autoFocus = false,
}: InputProps) => (
  <input
    type="text"
    value={value}
    onChange={(e) => onChange(e.target.value)}
    placeholder={placeholder}
    autoFocus={autoFocus}
  />
);
",
  "client/src/Message.tsx": "import {useRow, STORE_ID} from './ChatStore';
import './message.css';

interface MessageProps {
  rowId: string;
}

export const Message = ({rowId}: MessageProps) => {
  const row = useRow('messages', rowId, 'chat');
  const time = new Date((row as any).timestamp).toLocaleTimeString();

  return (
    <div className="message">
      <span className="username">{(row as any).username}:</span>
      <span className="text">{(row as any).text}</span>
      <span className="time">{time}</span>
    </div>
  );
};
",
  "client/src/MessageInput.tsx": "import {useState} from 'react';
import {useAddRowCallback, STORE_ID as CHAT_STORE_ID} from './ChatStore';
import {useValue, STORE_ID as SETTINGS_STORE_ID} from './SettingsStore';
import './messageInput.css';
import {Button} from './Button';
import {Input} from './Input';

export const MessageInput = () => {
  const [message, setMessage] = useState('');
  const username = useValue('username', SETTINGS_STORE_ID) || 'Anonymous';

  const handleSend = useAddRowCallback(
    'messages',
    () => ({
      username,
      text: message,
      timestamp: Date.now(),
    }),
    [message, username],
    CHAT_STORE_ID,
  );

  const onSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (message.trim()) {
      handleSend();
      setMessage('');
    }
  };

  return (
    <form onSubmit={onSubmit} id="messageInput">
      <Input
        value={message}
        onChange={setMessage}
        placeholder="Type a message..."
        autoFocus
      />
      <Button type="submit" variant="primary">
        Send
      </Button>
    </form>
  );
};
",
  "client/src/Messages.tsx": "import {useMemo} from 'react';
import {useRowIds, useStore, STORE_ID} from './ChatStore';
import './messages.css';
import {Message} from './Message';

export const Messages = () => {
  const store = useStore(STORE_ID);
  const messageIds = useRowIds('messages', STORE_ID);

  const sortedIds = useMemo(() => {
    return [...messageIds].sort((a, b) => {
      const rowA = store.getRow('messages', a) as any;
      const rowB = store.getRow('messages', b) as any;
      return rowA.timestamp - rowB.timestamp;
    });
  }, [messageIds, store]);

  return (
    <div id="messages">
      {sortedIds.map((id) => (
        <Message key={id} rowId={id} />
      ))}
    </div>
  );
};
",
  "client/src/SettingsStore.tsx": "import {createStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useValue,
  useSetValueCallback,
} from 'tinybase/ui-react';

export const STORE_ID = 'settings';

export {useValue, useSetValueCallback};

export const SettingsStore = () => {
  const store = useCreateStore(() =>
    createStore().setValue('username', 'Carol'),
  );

  useProvideStore(STORE_ID, store);

  return null;
};
",
  "client/src/UsernameInput.tsx": "import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';
import './usernameInput.css';
import {Input} from './Input';

export const UsernameInput = () => {
  const username = useValue('username', STORE_ID) || '';
  const setUsername = useSetValueCallback('username', (_e) => _e, [], STORE_ID);

  return (
    <div id="usernameInput">
      <label>Your name:</label>
      <Input
        value={username}
        onChange={setUsername}
        placeholder="Enter your name"
      />
    </div>
  );
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.tsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')!).render(<App />);
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/message.css": ".message {
  margin-bottom: 0.75rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.message .username {
  font-weight: 800;
  color: #d81b60;
}

.message .text {
  flex: 1;
}

.message .time {
  font-size: 0.8rem;
  color: #666;
}
",
  "client/src/messageInput.css": "#messageInput {
  display: flex;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid var(--border);
}
",
  "client/src/messages.css": "#messages {
  overflow-y: auto;
  padding: 1rem 0;
  height: 400px;
  margin-bottom: 1rem;
}
",
  "client/src/usernameInput.css": "#usernameInput {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

#usernameInput label {
  white-space: nowrap;
}

#usernameInput input {
  flex: 1;
}
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > ts-react-drawing > should match snapshot 1`] = `
{
  "README.md": "# test-ts-react-drawing

A TinyBase app built with TypeScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Drawing</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Drawing</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A collaborative drawing canvas showcasing TinyBase's state
              synchronization.
              <br /><br />
              Built with TypeScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-react-drawing",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.tsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {SettingsStore} from './SettingsStore';
import {CanvasStore} from './CanvasStore';
import {DrawingControls} from './DrawingControls';
import {Canvas} from './Canvas';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <SettingsStore />
        <CanvasStore />
        <DrawingControls />
        <Canvas />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/BrushSize.tsx": "import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';
import './brushSize.css';

export const BrushSize = () => {
  const size = useValue('brushSize', STORE_ID) ?? 5;

  const setSize = useSetValueCallback(
    'brushSize',
    (e: React.ChangeEvent<HTMLInputElement>) => parseInt(e.target.value),
    [],
    STORE_ID,
  );

  return (
    <div id="brushSize">
      <label>Size:</label>
      <input type="range" min="1" max="50" value={size} onChange={setSize} />
      <span id="brushSizeValue">{size}</span>
    </div>
  );
};
",
  "client/src/Button.tsx": "import './button.css';
import {ReactNode} from 'react';

interface ButtonProps {
  children: ReactNode;
  onClick?: () => void;
  variant?: 'default' | 'primary';
  type?: 'button' | 'submit';
}

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}: ButtonProps) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Canvas.tsx": "import {useCallback, useEffect, useRef} from 'react';
import {useTable, useStore, STORE_ID as CANVAS_STORE_ID} from './CanvasStore';
import {useValues, STORE_ID as SETTINGS_STORE_ID} from './SettingsStore';
import {getUniqueId} from 'tinybase';
import './canvas.css';

export const Canvas = () => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const isDrawing = useRef(false);
  const currentStrokeId = useRef<string | null>(null);
  const pointIndex = useRef(0);
  const brush = useValues(SETTINGS_STORE_ID);
  const strokes = useTable('strokes', CANVAS_STORE_ID);
  const store = useStore(CANVAS_STORE_ID);

  const draw = useCallback(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    Object.entries(strokes).forEach(([id, stroke]) => {
      if (stroke) {
        const points: Array<{x: number; y: number}> = [];
        let i = 0;
        while (stroke[\`x\${i}\`] !== undefined && stroke[\`y\${i}\`] !== undefined) {
          points.push({
            x: stroke[\`x\${i}\`] as number,
            y: stroke[\`y\${i}\`] as number,
          });
          i++;
        }
        if (points.length > 0) {
          ctx.strokeStyle = stroke.color as string;
          ctx.lineWidth = (stroke.size as number) * 2;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.beginPath();
          ctx.moveTo(points[0].x, points[0].y);
          for (let i = 1; i < points.length; i++) {
            ctx.lineTo(points[i].x, points[i].y);
          }
          ctx.stroke();
        }
      }
    });
  }, [strokes]);
  useEffect(() => {
    draw();
  }, [draw]);

  const getPoint = (e: MouseEvent | TouchEvent) => {
    const canvas = canvasRef.current;
    if (!canvas) return null;

    const rect = canvas.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;

    return {
      x: clientX - rect.left,
      y: clientY - rect.top,
    };
  };

  const handleStart = (e: React.MouseEvent | React.TouchEvent) => {
    isDrawing.current = true;
    pointIndex.current = 0;
    currentStrokeId.current = getUniqueId();

    store.setRow('strokes', currentStrokeId.current, {
      color: brush.brushColor,
      size: brush.brushSize,
    });

    const point = getPoint(e.nativeEvent);
    if (point) {
      store.setCell('strokes', currentStrokeId.current, 'x0', point.x);
      store.setCell('strokes', currentStrokeId.current, 'y0', point.y);
      pointIndex.current = 1;
    }
  };

  const handleMove = (e: React.MouseEvent | React.TouchEvent) => {
    if (isDrawing.current && currentStrokeId.current) {
      const point = getPoint(e.nativeEvent);
      if (point) {
        const idx = pointIndex.current;
        store.setCell('strokes', currentStrokeId.current, \`x\${idx}\`, point.x);
        store.setCell('strokes', currentStrokeId.current, \`y\${idx}\`, point.y);
        pointIndex.current++;
      }
    }
  };

  const handleEnd = () => {
    isDrawing.current = false;
    currentStrokeId.current = null;
    pointIndex.current = 0;
  };

  return (
    <canvas
      ref={canvasRef}
      width={600}
      height={400}
      id="drawingCanvas"
      onMouseDown={handleStart}
      onMouseMove={handleMove}
      onMouseUp={handleEnd}
      onMouseLeave={handleEnd}
      onTouchStart={handleStart}
      onTouchMove={handleMove}
      onTouchEnd={handleEnd}
    />
  );
};
",
  "client/src/CanvasStore.tsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useAddRowCallback,
  useDelTableCallback,
  useRow,
  useRowIds,
  useStore,
  useTable,
} from 'tinybase/ui-react';
import {getUniqueId} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
import type {MergeableStore} from 'tinybase';

export const STORE_ID = 'canvas';

export {
  useAddRowCallback,
  useDelTableCallback,
  useRow,
  useRowIds,
  useStore,
  useTable,
};

export const CanvasStore = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([{strokes: {}}, {}]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store: MergeableStore) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/ColorPicker.tsx": "import './colorPicker.css';
import {useValue, useSetValueCallback, STORE_ID} from './SettingsStore';

export const ColorPicker = () => {
  const colors = [
    '#d81b60',
    '#1976d2',
    '#388e3c',
    '#f57c00',
    '#7b1fa2',
    '#fff',
  ];
  const currentColor = useValue('brushColor', STORE_ID);

  const setColor = useSetValueCallback(
    'brushColor',
    (color: string) => color,
    [],
    STORE_ID,
  );

  return (
    <div id="colorPicker">
      {colors.map((color) => (
        <button
          key={color}
          className={\`colorBtn\${currentColor === color ? ' active' : ''}\`}
          style={{background: color}}
          onClick={() => setColor(color)}
        />
      ))}
    </div>
  );
};
",
  "client/src/DrawingControls.tsx": "import './drawingControls.css';
import {useDelTableCallback, STORE_ID} from './CanvasStore';
import {Button} from './Button';
import {ColorPicker} from './ColorPicker';
import {BrushSize} from './BrushSize';

export const DrawingControls = () => {
  const clearStrokes = useDelTableCallback('strokes', () => null, [], STORE_ID);

  return (
    <div id="drawingControls">
      <ColorPicker />
      <BrushSize />
      <Button onClick={clearStrokes} variant="primary">
        Clear
      </Button>
    </div>
  );
};
",
  "client/src/SettingsStore.tsx": "import {createStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useValue,
  useSetValueCallback,
  useValues,
} from 'tinybase/ui-react';

export const STORE_ID = 'settings';

export {useValue, useSetValueCallback, useValues};

export const SettingsStore = () => {
  const store = useCreateStore(() =>
    createStore().setValue('brushColor', '#d81b60').setValue('brushSize', 5),
  );

  useProvideStore(STORE_ID, store);

  return null;
};
",
  "client/src/brushSize.css": "#brushSize {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

#brushSize label {
  white-space: nowrap;
}

#brushSize input {
  width: 100px;
  vertical-align: middle;
}

#brushSizeValue {
  width: 2rem;
  min-width: 2rem;
  text-align: center;
  display: inline-block;
}
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/canvas.css": "#drawingCanvas {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  cursor: crosshair;
  display: block;
  touch-action: none;
  margin: 0 auto;
}
",
  "client/src/colorPicker.css": "#colorPicker {
  display: flex;
  gap: 0;
  align-items: center;
}

.colorBtn {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--border);
  border-radius: 0.25rem;
  cursor: pointer;
  transition: border-color 0.2s;
  margin: 0 0 0 0.5rem;
  padding: 0;
}

.colorBtn:hover,
.colorBtn.active {
  border-color: var(--accent);
}
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/drawingControls.css": "#drawingControls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;
  margin: 0 auto 1rem;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  justify-content: space-between;
  max-width: 600px;
}
",
  "client/src/index.tsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')!).render(<App />);
});
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > ts-react-game > should match snapshot 1`] = `
{
  "README.md": "# test-ts-react-game

A TinyBase app built with TypeScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Game</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Game</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A tic-tac-toe game demonstrating turn-based logic and computed
              game state.
              <br /><br />
              Built with TypeScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-react-game",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.tsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {Store} from './Store';
import {Game} from './Game';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <Store />
        <Game />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Board.tsx": "import './board.css';
import {useMemo} from 'react';
import {useValue, STORE_ID} from './Store';
import {Square} from './Square';

export const Board = () => {
  const gameStatus = useValue('gameStatus', STORE_ID);
  const winningLine = useValue('winningLine', STORE_ID);

  const winningPositions = useMemo(() => {
    if (!winningLine) return new Set();
    return new Set(winningLine.split(',').map(Number));
  }, [winningLine]);

  const disabled = gameStatus !== 'playing';

  return (
    <div id="board">
      {Array.from({length: 9}, (_, i) => (
        <Square
          key={i}
          position={i}
          disabled={disabled}
          winning={winningPositions.has(i)}
        />
      ))}
    </div>
  );
};
",
  "client/src/Button.tsx": "import './button.css';
import {ReactNode} from 'react';

interface ButtonProps {
  children: ReactNode;
  onClick?: () => void;
  variant?: 'default' | 'primary';
  type?: 'button' | 'submit';
}

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}: ButtonProps) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Game.tsx": "import {
  useStore,
  useSetValuesCallback,
  useTableListener,
  STORE_ID,
} from './Store';
import {Button} from './Button';
import {Board} from './Board';
import {GameStatus} from './GameStatus';

const WINNING_LINES = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6],
];

export const Game = () => {
  const store = useStore(STORE_ID);

  useTableListener(
    'board',
    () => {
      const gameStatus = store.getValue('gameStatus');
      if (gameStatus !== 'playing') return;

      const board = store.getTable('board');

      for (const line of WINNING_LINES) {
        const [a, b, c] = line;
        const cellA = board[a]?.value;
        const cellB = board[b]?.value;
        const cellC = board[c]?.value;

        if (cellA && cellA === cellB && cellA === cellC) {
          store.setValue('gameStatus', 'won');
          store.setValue('winner', cellA);
          store.setValue('winningLine', line.join(','));
          return;
        }
      }

      const filledCells = Object.values(board).filter(
        (cell: any) => cell.value,
      ).length;
      if (filledCells === 9) {
        store.setValue('gameStatus', 'draw');
        return;
      }

      const currentPlayer = store.getValue('currentPlayer');
      store.setValue('currentPlayer', currentPlayer === 'X' ? 'O' : 'X');
    },
    [],
    true,
    STORE_ID,
  );

  const resetGame = useSetValuesCallback(() => {
    store.delTable('board');
    return {currentPlayer: 'X', gameStatus: 'playing'};
  }, []);

  return (
    <>
      <GameStatus />
      <Board />
      <div style={{textAlign: 'center', marginTop: '2rem'}}>
        <Button onClick={resetGame} variant="primary">
          New Game
        </Button>
      </div>
    </>
  );
};
",
  "client/src/GameStatus.tsx": "import './gameStatus.css';
import {useValue, STORE_ID} from './Store';

export const GameStatus = () => {
  const gameStatus = useValue('gameStatus', STORE_ID);
  const currentPlayer = useValue('currentPlayer', STORE_ID);
  const winner = useValue('winner', STORE_ID);

  return (
    <div id="gameStatus">
      {gameStatus === 'playing' && (
        <>
          Player <span className="player">{currentPlayer}</span>'s turn
        </>
      )}
      {gameStatus === 'won' && (
        <>
          Player <span className="winner">{winner}</span> wins!
        </>
      )}
      {gameStatus === 'draw' && <>It's a draw!</>}
    </div>
  );
};
",
  "client/src/Square.tsx": "import './square.css';
import {useCell, useStore, useValue, STORE_ID} from './Store';

export const Square = ({
  position,
  disabled,
  winning,
}: {
  position: number;
  disabled: boolean;
  winning: boolean;
}) => {
  const store = useStore(STORE_ID);
  const value = useCell('board', position.toString(), 'value', STORE_ID);
  const currentPlayer = useValue('currentPlayer', STORE_ID);

  const isDisabled = disabled || !!value;

  const handleClick = () => {
    if (!isDisabled) {
      store.setCell('board', position.toString(), 'value', currentPlayer);
    }
  };

  return (
    <button
      className={\`square\${isDisabled ? ' disabled' : ''}\${winning ? ' winning' : ''}\`}
      onClick={handleClick}
      disabled={isDisabled}
    >
      {value || ''}
    </button>
  );
};
",
  "client/src/Store.tsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateStore,
  useProvideStore,
  useStore,
  useSetValuesCallback,
  useTableListener,
  useCell,
  useValue,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
import type {MergeableStore} from 'tinybase';

export const STORE_ID = 'game';

export {useStore, useSetValuesCallback, useTableListener, useCell, useValue};

export const Store = () => {
  const store = useCreateStore(() =>
    createMergeableStore().setDefaultContent([
      {},
      {
        currentPlayer: 'X',
        gameStatus: 'playing',
      },
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store: MergeableStore) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/board.css": "#board {
  display: grid;
  grid-template-columns: repeat(3, 100px);
  grid-template-rows: repeat(3, 100px);
  gap: 1px;
  background: var(--border);
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  overflow: hidden;
  margin: 0 auto 2rem;
  width: fit-content;
  padding: 1px;
}
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/gameStatus.css": "#gameStatus {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 800;
  margin: 2rem 0 1rem;
  color: var(--accent);
}

#gameStatus .winner {
  color: var(--accent);
  animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}
",
  "client/src/index.tsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')!).render(<App />);
});
",
  "client/src/square.css": ".square {
  width: 100px;
  height: 100px;
  background: var(--bg2);
  border: none;
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
}

.square:hover:not(.square.disabled) {
  background: var(--bg);
  outline: 2px solid var(--accent);
  outline-offset: -2px;
  z-index: 1;
  position: relative;
}

.square:disabled {
  cursor: not-allowed;
}

.square.disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.square.winning {
  background: var(--accent);
  color: var(--bg);
}
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > ts-react-todos > should match snapshot 1`] = `
{
  "README.md": "# test-ts-react-todos

A TinyBase app built with TypeScript and React.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Todos</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Todos</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A simple todo list application demonstrating TinyBase's reactive
              data management with CRUD operations.
              <br /><br />
              Built with TypeScript and React.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-react-todos",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^4.3.4"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/App.tsx": "import {StrictMode} from 'react';
import {Provider} from 'tinybase/ui-react';
import {Inspector} from 'tinybase/ui-react-inspector';
import {Store} from './Store';
import {TodoInput} from './TodoInput';
import {TodoList} from './TodoList';

export const App = () => {
  return (
    <StrictMode>
      <Provider>
        <Store />
        <TodoInput />
        <TodoList />
        <Inspector />
      </Provider>
    </StrictMode>
  );
};
",
  "client/src/Button.tsx": "import './button.css';
import {ReactNode} from 'react';

interface ButtonProps {
  children: ReactNode;
  onClick?: () => void;
  variant?: 'default' | 'primary';
  type?: 'button' | 'submit';
}

export const Button = ({
  children,
  onClick,
  variant = 'default',
  type = 'button',
}: ButtonProps) => (
  <button
    onClick={onClick}
    type={type}
    className={variant === 'primary' ? 'primary' : undefined}
  >
    {children}
  </button>
);
",
  "client/src/Input.tsx": "import './input.css';

interface InputProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  autoFocus?: boolean;
}

export const Input = ({
  value,
  onChange,
  placeholder = '',
  autoFocus = false,
}: InputProps) => (
  <input
    type="text"
    value={value}
    onChange={(e) => onChange(e.target.value)}
    placeholder={placeholder}
    autoFocus={autoFocus}
  />
);
",
  "client/src/Store.tsx": "import {createMergeableStore} from 'tinybase';
import {
  useCreateMergeableStore,
  useProvideStore,
  useAddRowCallback,
  useDelRowCallback,
  useRow,
  useRowIds,
  useSetPartialRowCallback,
} from 'tinybase/ui-react';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
import {useCreateSynchronizer} from 'tinybase/ui-react';
import type {MergeableStore} from 'tinybase';

export {
  useAddRowCallback,
  useDelRowCallback,
  useRow,
  useRowIds,
  useSetPartialRowCallback,
};

export const STORE_ID = 'todos';

export const Store = () => {
  const store = useCreateMergeableStore(() =>
    createMergeableStore().setDefaultContent([
      {
        todos: {
          '1': {text: 'Learn TinyBase', completed: false},
          '2': {text: 'Build an app', completed: false},
        },
      },
      {},
    ]),
  );

  useProvideStore(STORE_ID, store);

  useCreateSynchronizer(store, async (store: MergeableStore) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
      store,
      new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
      synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
  });

  return null;
};
",
  "client/src/TodoInput.tsx": "import './todoInput.css';
import {useState} from 'react';
import {useAddRowCallback, STORE_ID} from './Store';
import {Button} from './Button';
import {Input} from './Input';

export const TodoInput = () => {
  const [text, setText] = useState('');
  const addRow = useAddRowCallback(
    'todos',
    () => ({text, completed: false}),
    [text],
    STORE_ID,
  );

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (text.trim()) {
      addRow();
      setText('');
    }
  };

  return (
    <form id="todoInput" onSubmit={handleSubmit}>
      <Input
        value={text}
        onChange={setText}
        placeholder="What needs to be done?"
        autoFocus
      />
      <Button type="submit" variant="primary">
        Add
      </Button>
    </form>
  );
};
",
  "client/src/TodoItem.tsx": "import './todoItem.css';
import {
  useDelRowCallback,
  useRow,
  useSetPartialRowCallback,
  STORE_ID,
} from './Store';
import {Button} from './Button';

export const TodoItem = ({rowId}: {rowId: string}) => {
  const todo = useRow('todos', rowId, STORE_ID);
  const setPartialRow = useSetPartialRowCallback(
    'todos',
    rowId,
    (e: React.ChangeEvent<HTMLInputElement>) => ({completed: e.target.checked}),
    [],
    STORE_ID,
  );
  const delRow = useDelRowCallback('todos', rowId, STORE_ID);

  return (
    <div className={\`todoItem\${todo.completed ? ' completed' : ''}\`}>
      <input
        type="checkbox"
        checked={todo.completed}
        onChange={setPartialRow}
        id={\`todo-\${rowId}\`}
      />
      <label htmlFor={\`todo-\${rowId}\`}>{todo.text}</label>
      <Button onClick={delRow}>Delete</Button>
    </div>
  );
};
",
  "client/src/TodoList.tsx": "import './todoList.css';
import {useRowIds, STORE_ID} from './Store';
import {TodoItem} from './TodoItem';

export const TodoList = () => {
  const todoIds = useRowIds('todos', STORE_ID);

  return (
    <div id="todoList">
      {todoIds.map((id) => (
        <TodoItem key={id} rowId={id} />
      ))}
    </div>
  );
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.tsx": "import {getUniqueId} from 'tinybase';
import ReactDOM from 'react-dom/client';
import {App} from './App';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  ReactDOM.createRoot(document.getElementById('app')!).render(<App />);
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/todoInput.css": "#todoInput {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

#todoInput input {
  flex: 1;
}
",
  "client/src/todoItem.css": ".todoItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
}

.todoItem:last-child {
  border-bottom: none;
}

.todoItem input[type='checkbox'] {
  width: 1.25rem;
  height: 1.25rem;
  cursor: pointer;
  flex-shrink: 0;
}

.todoItem label {
  flex: 1;
  cursor: pointer;
  user-select: none;
}

.todoItem.completed label {
  text-decoration: line-through;
  opacity: 0.6;
}

.todoItem button {
  flex-shrink: 0;
}
",
  "client/src/todoList.css": "#todoList {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  overflow: hidden;
  background: var(--bg2);
}

#todoList:empty::before {
  content: 'No todos yet. Add one above!';
  display: block;
  padding: 2rem;
  text-align: center;
  color: var(--fg2);
}
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
  "client/vite.config.js": "import {defineConfig} from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
  ],
});
",
}
`;

exports[`create-tinybase > ts-vanilla-chat > should match snapshot 1`] = `
{
  "README.md": "# test-ts-vanilla-chat

A TinyBase app built with TypeScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Chat</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Chat</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A real-time chat application demonstrating TinyBase's reactive
              data management.
              <br /><br />
              Built with TypeScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-vanilla-chat",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.ts": "import {settingsStore} from './settingsStore';
import {chatStore} from './chatStore';
import {createButton} from './button';
import {createInput} from './input';
import {createMessage} from './message';
import {createMessages} from './messages';
import {createUsernameInput} from './usernameInput';
import {createMessageInput} from './messageInput';

export const app = () => {
  const appContainer = document.getElementById('app')!;

  appContainer.appendChild(createUsernameInput(settingsStore, chatStore));
  appContainer.appendChild(createMessages(chatStore));

  const messageInputContainer = createMessageInput(settingsStore, chatStore);
  appContainer.appendChild(messageInputContainer);

  const messageInput = messageInputContainer.querySelector('input')!;
  messageInput.focus();
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.ts": "import './button.css';

export const createButton = (
  text: string,
  onClick: () => void,
  variant: 'default' | 'primary' = 'default',
): HTMLButtonElement => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/chatStore.ts": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const chatStore = createMergeableStore().setDefaultContent([
  {
    messages: {
      '1': {username: 'Alice', text: 'Hello!', timestamp: Date.now() - 60000},
      '2': {username: 'Bob', text: 'Hi there!', timestamp: Date.now() - 30000},
    },
  },
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  chatStore,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});

export type ChatStore = typeof chatStore;
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.ts": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/input.ts": "import './input.css';

export const createInput = (
  placeholder: string = '',
  value: string = '',
  onInput?: (value: string) => void,
): HTMLInputElement => {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = placeholder;
  input.value = value;
  if (onInput) {
    input.addEventListener('input', () => onInput(input.value));
  }
  return input;
};
",
  "client/src/message.css": ".message {
  margin-bottom: 0.75rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.message .username {
  font-weight: 800;
  color: #d81b60;
}

.message .text {
  flex: 1;
}

.message .time {
  font-size: 0.8rem;
  color: #666;
}
",
  "client/src/message.ts": "import './message.css';

export const createMessage = (
  username: string,
  text: string,
  timestamp: number,
): HTMLDivElement => {
  const time = new Date(timestamp).toLocaleTimeString();

  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';

  const usernameSpan = document.createElement('span');
  usernameSpan.className = 'username';
  usernameSpan.textContent = \`\${username}:\`;

  const textSpan = document.createElement('span');
  textSpan.className = 'text';
  textSpan.textContent = text;

  const timeSpan = document.createElement('span');
  timeSpan.className = 'time';
  timeSpan.textContent = time;

  messageDiv.appendChild(usernameSpan);
  messageDiv.appendChild(textSpan);
  messageDiv.appendChild(timeSpan);

  return messageDiv;
};
",
  "client/src/messageInput.css": "#messageInput {
  display: flex;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid var(--border);
}
",
  "client/src/messageInput.ts": "import './messageInput.css';
import {type SettingsStore} from './settingsStore';
import {type ChatStore} from './chatStore';
import {createButton} from './button';
import {createInput} from './input';

export const createMessageInput = (
  settingsStore: SettingsStore,
  chatStore: ChatStore,
): HTMLDivElement => {
  const messageInputContainer = document.createElement('div');
  messageInputContainer.id = 'messageInput';

  const messageInput = createInput('Type a message...');
  messageInputContainer.appendChild(messageInput);

  const sendMessage = () => {
    const text = messageInput.value.trim();
    if (text) {
      chatStore.addRow('messages', {
        username: settingsStore.getValue('username'),
        text,
        timestamp: Date.now(),
      });
      messageInput.value = '';
      messageInput.focus();
    }
  };

  messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      sendMessage();
    }
  });

  const sendButton = createButton('Send', sendMessage, 'primary');
  messageInputContainer.appendChild(sendButton);

  return messageInputContainer;
};
",
  "client/src/messages.css": "#messages {
  overflow-y: auto;
  padding: 1rem 0;
  height: 400px;
  margin-bottom: 1rem;
}
",
  "client/src/messages.ts": "import './messages.css';
import {type ChatStore} from './chatStore';
import {createMessage} from './message';

export const createMessages = (store: ChatStore): HTMLDivElement => {
  const messagesContainer = document.createElement('div');
  messagesContainer.id = 'messages';

  const updateMessages = () => {
    const messageRows = store.getTable('messages');
    const sortedIds = Object.keys(messageRows).sort(
      (a, b) => messageRows[a].timestamp - messageRows[b].timestamp,
    );

    messagesContainer.innerHTML = '';
    sortedIds.forEach((id) => {
      const msg = messageRows[id];
      const messageElement = createMessage(
        msg.username,
        msg.text,
        msg.timestamp,
      );
      messagesContainer.appendChild(messageElement);
    });
  };

  updateMessages();

  store.addTablesListener(updateMessages);

  return messagesContainer;
};
",
  "client/src/settingsStore.ts": "import {createStore} from 'tinybase';

export const settingsStore = createStore().setValue('username', 'Carol');

export type SettingsStore = typeof settingsStore;
",
  "client/src/usernameInput.css": "#usernameInput {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

#usernameInput label {
  white-space: nowrap;
}

#usernameInput input {
  flex: 1;
}
",
  "client/src/usernameInput.ts": "import './usernameInput.css';
import {type SettingsStore} from './settingsStore';
import {type ChatStore} from './chatStore';
import {createInput} from './input';

export const createUsernameInput = (
  settingsStore: SettingsStore,
  chatStore: ChatStore,
): HTMLDivElement => {
  const container = document.createElement('div');
  container.id = 'usernameInput';

  const label = document.createElement('label');
  label.textContent = 'Your name:';

  const usernameInput = createInput(
    'Enter your name',
    settingsStore.getValue('username') as string,
  );

  container.appendChild(label);
  container.appendChild(usernameInput);

  usernameInput.addEventListener('input', () => {
    settingsStore.setValue('username', usernameInput.value);
  });

  settingsStore.addValuesListener(() => {
    usernameInput.value = settingsStore.getValue('username') as string;
  });

  return container;
};
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
}
`;

exports[`create-tinybase > ts-vanilla-drawing > should match snapshot 1`] = `
{
  "README.md": "# test-ts-vanilla-drawing

A TinyBase app built with TypeScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Drawing</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Drawing</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A collaborative drawing canvas showcasing TinyBase's state
              synchronization.
              <br /><br />
              Built with TypeScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-vanilla-drawing",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.ts": "import {settingsStore} from './settingsStore';
import {canvasStore} from './canvasStore';
import {createDrawingControls} from './drawingControls';
import {createCanvas} from './canvas';

export const app = () => {
  const appContainer = document.getElementById('app')!;

  appContainer.appendChild(createDrawingControls(settingsStore, canvasStore));
  appContainer.appendChild(createCanvas(settingsStore, canvasStore));
};
",
  "client/src/brushSize.css": "#brushSize {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

#brushSize label {
  white-space: nowrap;
}

#brushSize input {
  width: 100px;
  vertical-align: middle;
}

#brushSizeValue {
  width: 2rem;
  min-width: 2rem;
  text-align: center;
  display: inline-block;
}
",
  "client/src/brushSize.ts": "import './brushSize.css';
import type {Store as SettingsStore} from './settingsStore';

export const createBrushSize = (store: SettingsStore): HTMLDivElement => {
  const container = document.createElement('div');
  container.id = 'brushSize';

  const label = document.createElement('label');
  label.textContent = 'Size:';

  const sizeSlider = document.createElement('input');
  sizeSlider.type = 'range';
  sizeSlider.min = '1';
  sizeSlider.max = '50';
  sizeSlider.value = '5';

  const sizeLabel = document.createElement('span');
  sizeLabel.id = 'brushSizeValue';
  sizeLabel.textContent = '5';

  sizeSlider.addEventListener('input', () => {
    const size = parseInt(sizeSlider.value);
    store.setValue('brushSize', size);
    sizeLabel.textContent = \`\${size}\`;
  });

  container.appendChild(label);
  container.appendChild(sizeSlider);
  container.appendChild(sizeLabel);

  return container;
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.ts": "import './button.css';

export const createButton = (
  text: string,
  onClick: () => void,
  variant: 'default' | 'primary' = 'default',
): HTMLButtonElement => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/canvas.css": "#drawingCanvas {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  cursor: crosshair;
  display: block;
  touch-action: none;
  margin: 0 auto;
}
",
  "client/src/canvas.ts": "import './canvas.css';
import {getUniqueId} from 'tinybase';
import type {Store as SettingsStore} from './settingsStore';
import type {Store as CanvasStore} from './canvasStore';

export const createCanvas = (
  settingsStore: SettingsStore,
  canvasStore: CanvasStore,
): HTMLCanvasElement => {
  const canvas = document.createElement('canvas');
  canvas.id = 'drawingCanvas';
  canvas.width = 600;
  canvas.height = 400;

  const ctx = canvas.getContext('2d')!;
  let isDrawing = false;
  let currentStrokeId: string | null = null;
  let pointIndex = 0;

  const draw = () => {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas!.width, canvas!.height);

    const strokes = canvasStore.getTable('strokes');
    Object.entries(strokes).forEach(([id, stroke]: [string, any]) => {
      const points: Array<{x: number; y: number}> = [];
      let i = 0;
      while (stroke[\`x\${i}\`] !== undefined && stroke[\`y\${i}\`] !== undefined) {
        points.push({x: stroke[\`x\${i}\`], y: stroke[\`y\${i}\`]});
        i++;
      }
      if (points.length > 0) {
        ctx.strokeStyle = stroke.color;
        ctx.lineWidth = stroke.size * 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        for (let i = 1; i < points.length; i++) {
          ctx.lineTo(points[i].x, points[i].y);
        }
        ctx.stroke();
      }
    });
  };
  const addPoint = (e: MouseEvent | TouchEvent) => {
    if (!currentStrokeId) return;

    const rect = canvas!.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;

    canvasStore.setCell(
      'strokes',
      currentStrokeId,
      \`x\${pointIndex}\`,
      clientX - rect.left,
    );
    canvasStore.setCell(
      'strokes',
      currentStrokeId,
      \`y\${pointIndex}\`,
      clientY - rect.top,
    );
    pointIndex++;
  };

  const startStroke = (e: MouseEvent | TouchEvent) => {
    const brush = settingsStore.getValues() as any;
    currentStrokeId = getUniqueId();
    pointIndex = 0;

    canvasStore.setRow('strokes', currentStrokeId, {
      color: brush.brushColor,
      size: brush.brushSize,
    });

    addPoint(e);
  };

  canvas.addEventListener('mousedown', (e) => {
    isDrawing = true;
    startStroke(e);
  });

  canvas.addEventListener('mouseup', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvas.addEventListener('mouseleave', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvas.addEventListener('mousemove', (e) => {
    if (isDrawing) addPoint(e);
  });

  canvas.addEventListener('touchstart', (e) => {
    isDrawing = true;
    startStroke(e);
    e.preventDefault();
  });

  canvas.addEventListener('touchmove', (e) => {
    if (isDrawing) {
      addPoint(e);
      e.preventDefault();
    }
  });

  canvas.addEventListener('touchend', () => {
    isDrawing = false;
    currentStrokeId = null;
  });

  canvasStore.addTablesListener(draw);
  draw();

  return canvas;
};
",
  "client/src/canvasStore.ts": "import {createMergeableStore} from 'tinybase';
import {getUniqueId} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const canvasStore = createMergeableStore().setDefaultContent([
  {strokes: {}},
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  canvasStore,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});

export type CanvasStore = typeof canvasStore;
",
  "client/src/colorPicker.css": "#colorPicker {
  display: flex;
  gap: 0;
  align-items: center;
}

.colorBtn {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--border);
  border-radius: 0.25rem;
  cursor: pointer;
  transition: border-color 0.2s;
  margin: 0 0 0 0.5rem;
  padding: 0;
}

.colorBtn:hover,
.colorBtn.active {
  border-color: var(--accent);
}
",
  "client/src/colorPicker.ts": "import './colorPicker.css';
import type {Store as SettingsStore} from './settingsStore';

export const createColorPicker = (store: SettingsStore): HTMLDivElement => {
  const colors = [
    '#d81b60',
    '#1976d2',
    '#388e3c',
    '#f57c00',
    '#7b1fa2',
    '#fff',
  ];
  const container = document.createElement('div');
  container.id = 'colorPicker';

  const buttons: HTMLButtonElement[] = [];

  colors.forEach((color) => {
    const btn = document.createElement('button');
    btn.className = 'colorBtn';
    btn.style.background = color;
    btn.addEventListener('click', () => {
      store.setValue('brushColor', color);
    });
    container.appendChild(btn);
    buttons.push(btn);
  });

  const updateActive = () => {
    const currentColor = store.getValue('brushColor');
    buttons.forEach((btn, i) => {
      btn.classList.toggle('active', colors[i] === currentColor);
    });
  };

  store.addValueListener('brushColor', updateActive);
  updateActive();

  return container;
};
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/drawingControls.css": "#drawingControls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;
  margin: 0 auto 1rem;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  justify-content: space-between;
  max-width: 600px;
}
",
  "client/src/drawingControls.ts": "import './drawingControls.css';
import type {Store as SettingsStore} from './settingsStore';
import type {Store as CanvasStore} from './canvasStore';
import {createButton} from './button';
import {createColorPicker} from './colorPicker';
import {createBrushSize} from './brushSize';

export const createDrawingControls = (
  settingsStore: SettingsStore,
  canvasStore: CanvasStore,
): HTMLDivElement => {
  const controls = document.createElement('div');
  controls.id = 'drawingControls';

  controls.appendChild(createColorPicker(settingsStore));
  controls.appendChild(createBrushSize(settingsStore));

  const clearButton = createButton(
    'Clear',
    () => canvasStore.delTable('strokes'),
    'primary',
  );
  controls.appendChild(clearButton);

  return controls;
};
",
  "client/src/index.ts": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/settingsStore.ts": "import {createStore} from 'tinybase';

export const settingsStore = createStore()
  .setValue('brushColor', '#d81b60')
  .setValue('brushSize', 5);

export type SettingsStore = typeof settingsStore;
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
}
`;

exports[`create-tinybase > ts-vanilla-game > should match snapshot 1`] = `
{
  "README.md": "# test-ts-vanilla-game

A TinyBase app built with TypeScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Game</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Game</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A tic-tac-toe game demonstrating turn-based logic and computed
              game state.
              <br /><br />
              Built with TypeScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-vanilla-game",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.ts": "import {store} from './store';
import {createGame} from './game';

export const app = () => {
  const appContainer = document.getElementById('app')!;
  appContainer.appendChild(createGame(store));
};
",
  "client/src/board.css": "#board {
  display: grid;
  grid-template-columns: repeat(3, 100px);
  grid-template-rows: repeat(3, 100px);
  gap: 1px;
  background: var(--border);
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  overflow: hidden;
  margin: 0 auto 2rem;
  width: fit-content;
  padding: 1px;
}
",
  "client/src/board.ts": "import './board.css';
import type {GameStore} from './store';
import {createSquare} from './square';

export const createBoard = (store: GameStore): HTMLDivElement => {
  const board = document.createElement('div');
  board.id = 'board';

  const render = () => {
    const gameStatus = store.getValue('gameStatus');
    const winningLine = store.getValue('winningLine');
    const currentPlayer = store.getValue('currentPlayer');
    const winningPositions = new Set(
      winningLine ? winningLine.split(',').map(Number) : [],
    );
    const disabled = gameStatus !== 'playing';

    board.innerHTML = '';
    for (let i = 0; i < 9; i++) {
      const cell = store.getCell('board', i.toString(), 'value');
      const square = createSquare(
        i,
        cell,
        () => {
          if (gameStatus === 'playing' && !cell) {
            store.setCell('board', i.toString(), 'value', currentPlayer);
          }
        },
        disabled || !!cell,
        winningPositions.has(i),
      );
      board.appendChild(square);
    }
  };

  store.addValuesListener(render);
  store.addTableListener('board', render);
  render();

  return board;
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.ts": "import './button.css';

export const createButton = (
  text: string,
  onClick: () => void,
  variant: 'default' | 'primary' = 'default',
): HTMLButtonElement => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/game.ts": "import type {GameStore} from './store';
import {createButton} from './button';
import {createBoard} from './board';
import {createGameStatus} from './gameStatus';

const WINNING_LINES = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6],
];

export const createGame = (store: GameStore): HTMLDivElement => {
  const checkGameState = () => {
    const gameStatus = store.getValue('gameStatus');
    if (gameStatus !== 'playing') return;

    const board = store.getTable('board');

    for (const line of WINNING_LINES) {
      const [a, b, c] = line;
      const cellA = board[a]?.value;
      const cellB = board[b]?.value;
      const cellC = board[c]?.value;

      if (cellA && cellA === cellB && cellA === cellC) {
        store.setValue('gameStatus', 'won');
        store.setValue('winner', cellA);
        store.setValue('winningLine', line.join(','));
        return;
      }
    }

    const filledCells = Object.values(board).filter(
      (cell: any) => cell.value,
    ).length;
    if (filledCells === 9) {
      store.setValue('gameStatus', 'draw');
      return;
    }

    const currentPlayer = store.getValue('currentPlayer');
    store.setValue('currentPlayer', currentPlayer === 'X' ? 'O' : 'X');
  };

  store.addTableListener('board', checkGameState, true);

  const resetGame = () => {
    store.delTable('board');
    store.setValues({
      currentPlayer: 'X',
      gameStatus: 'playing',
    });
  };

  const gameContainer = document.createElement('div');

  gameContainer.appendChild(createGameStatus(store));
  gameContainer.appendChild(createBoard(store));

  const buttonContainer = document.createElement('div');
  buttonContainer.style.textAlign = 'center';
  buttonContainer.style.marginTop = '2rem';
  buttonContainer.appendChild(createButton('New Game', resetGame, 'primary'));
  gameContainer.appendChild(buttonContainer);

  return gameContainer;
};
",
  "client/src/gameStatus.css": "#gameStatus {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 800;
  margin: 2rem 0 1rem;
  color: var(--accent);
}

#gameStatus .winner {
  color: var(--accent);
  animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}
",
  "client/src/gameStatus.ts": "import './gameStatus.css';
import type {GameStore} from './store';

export const createGameStatus = (store: GameStore): HTMLDivElement => {
  const status = document.createElement('div');
  status.id = 'gameStatus';

  const render = () => {
    const gameStatus = store.getValue('gameStatus');
    const currentPlayer = store.getValue('currentPlayer');
    const winner = store.getValue('winner');

    if (gameStatus === 'playing') {
      status.innerHTML = \`Player <span class="player">\${currentPlayer}</span>'s turn\`;
    } else if (gameStatus === 'won') {
      status.innerHTML = \`Player <span class="winner">\${winner}</span> wins!\`;
    } else if (gameStatus === 'draw') {
      status.textContent = "It's a draw!";
    }
  };

  store.addValuesListener(render);
  render();

  return status;
};
",
  "client/src/index.ts": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/square.css": ".square {
  width: 100px;
  height: 100px;
  background: var(--bg2);
  border: none;
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
}

.square:hover:not(.square.disabled) {
  background: var(--bg);
  outline: 2px solid var(--accent);
  outline-offset: -2px;
  z-index: 1;
  position: relative;
}

.square:disabled {
  cursor: not-allowed;
}

.square.disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.square.winning {
  background: var(--accent);
  color: var(--bg);
}
",
  "client/src/square.ts": "import './square.css';

export const createSquare = (
  position: number,
  value: string | undefined,
  onClick: () => void,
  disabled: boolean,
  winning: boolean,
): HTMLButtonElement => {
  const square = document.createElement('button');
  square.className = \`square\${disabled ? ' disabled' : ''}\${winning ? ' winning' : ''}\`;
  square.textContent = value || '';
  square.disabled = disabled;
  square.addEventListener('click', onClick);
  return square;
};
",
  "client/src/store.ts": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const store = createMergeableStore().setDefaultContent([
  {},
  {
    currentPlayer: 'X',
    gameStatus: 'playing',
  },
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});

export type GameStore = typeof store;
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
}
`;

exports[`create-tinybase > ts-vanilla-todos > should match snapshot 1`] = `
{
  "README.md": "# test-ts-vanilla-todos

A TinyBase app built with TypeScript and Vanilla JS.

## Getting Started

Alongside this file, you will see a directory called \`client\` (and optionally
one called \`server\` if you included server code).

To start the web client with Vite, run the following commands:

\`\`\`bash
cd client
npm install
npm run dev
\`\`\`

PNPM, Yarn, and Bun should also work. Your app will be available at
\`http://localhost:5173\`, or whichever port Vite specifies in the console.

After that, start hacking!

## Learn More

- [TinyBase Documentation](https://tinybase.org)
- [TinyBase Examples](https://tinybase.org/demos/)
",
  "client/index.html": "<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap"
    />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>TinyBase Todos</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --hue: 270;
        --fg: oklch(85% 0.01 var(--hue));
        --fg2: oklch(60% 0.01 var(--hue));
        --bg: oklch(20% 0.01 var(--hue));
        --bg2: oklch(25% 0.01 var(--hue));
        --border: oklch(30% 0.01 var(--hue));
        --bg-header: oklch(30% 0.008 var(--hue) / 0.5);
        --accent: #d81b60;
        color: var(--fg);
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
      }

      #appContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      #topBar {
        background: var(--bg-header);
        border-bottom: 1px solid var(--border);
        box-shadow: 0 1px 2px 0 #0007;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(4px);
      }

      #topBarLogo {
        height: 2rem;
        width: 2rem;
        flex-shrink: 0;
      }

      #topBarTitle {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      #topBarInfo {
        position: relative;
      }

      #infoIcon {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid var(--fg2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--fg2);
        cursor: help;
        transition: all 0.2s;
        user-select: none;
      }

      #infoIcon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      #infoIcon:hover #infoTooltip {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #infoTooltip {
        position: absolute;
        right: 0;
        top: calc(100% + 0.5rem);
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        font-weight: 400;
        width: 20rem;
        white-space: normal;
        color: var(--fg);
        line-height: 1.5;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.25rem);
        transition: all 0.2s;
        pointer-events: none;
        box-shadow: 0 1px 2px 0 #0007;
      }

      #infoTooltip a {
        color: var(--fg);
        text-decoration: underline;
      }

      #infoTooltip::before {
        content: '';
        position: absolute;
        right: 0.75rem;
        top: -0.375rem;
        width: 0.75rem;
        height: 0.75rem;
        background: var(--bg2);
        border-left: 1px solid var(--border);
        border-top: 1px solid var(--border);
        transform: rotate(45deg);
      }

      #app {
        max-width: 60rem;
        width: 100%;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    </style>
  </head>

  <body>
    <div id="appContainer">
      <div id="topBar">
        <img src="/favicon.svg" id="topBarLogo" alt="TinyBase" />
        <div id="topBarTitle">TinyBase Todos</div>
        <div id="topBarInfo">
          <div id="infoIcon">
            i
            <div id="infoTooltip">
              A simple todo list application demonstrating TinyBase's reactive
              data management with CRUD operations.
              <br /><br />
              Built with TypeScript.
            </div>
          </div>
        </div>
      </div>
      <div id="app"></div>
    </div>

    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
",
  "client/package.json": "{
  "name": "test-ts-vanilla-todos",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^7.1.3",
    "typescript": "^5.9.3",
    "@types/node": "^25.0.3"
  },
  "dependencies": {
    "tinybase": "^7.3.1",
    "reconnecting-websocket": "^4.4.0"
  }
}
",
  "client/public/favicon.svg": "<svg viewBox="0 0 680 680" xmlns="http://www.w3.org/2000/svg" style="width:680px;height:680px">
  <path stroke="#fff" stroke-width="80" fill="none"
    d="M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
  <path fill="#d81b60"
    d="M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z" />
  <path
    d="M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z" />
</svg>",
  "client/src/app.ts": "import {store} from './store';
import {createTodoInput} from './todoInput';
import {createTodoList} from './todoList';

export const app = () => {
  const appContainer = document.getElementById('app')!;

  const todoInputContainer = createTodoInput(store);
  appContainer.appendChild(todoInputContainer);

  const input = todoInputContainer.querySelector('input')!;
  input.focus();

  appContainer.appendChild(createTodoList(store));
};
",
  "client/src/button.css": "button {
  padding: 0.5rem 1rem;
  border: 1px solid #666;
  border-radius: 0.25rem;
  background: #222;
  color: #fff;
  font-family: inherit;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
}

button:hover {
  border-color: #d81b60;
}

button.primary {
  background: #d81b60;
  border: none;
  padding: 0.75rem 1.5rem;
}

button.primary:hover {
  background: #c2185b;
}
",
  "client/src/button.ts": "import './button.css';

export const createButton = (
  text: string,
  onClick: () => void,
  variant: 'default' | 'primary' = 'default',
): HTMLButtonElement => {
  const button = document.createElement('button');
  button.textContent = text;
  if (variant === 'primary') {
    button.className = 'primary';
  }
  button.addEventListener('click', onClick);
  return button;
};
",
  "client/src/config.ts": "export const SERVER = 'wss://vite.tinybase.org';
",
  "client/src/index.ts": "import {getUniqueId} from 'tinybase';
import {app} from './app';

if (location.pathname === '/') {
  location.assign('/' + getUniqueId());
}

addEventListener('load', () => {
  app();
});
",
  "client/src/input.css": "input[type='text'] {
  padding: 0.5rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  color: var(--fg);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  width: 100%;
  box-sizing: border-box;
  align-self: center;
}

input[type='text']:focus {
  outline: none;
  border-color: var(--accent);
}

input[type='text']::placeholder {
  color: var(--fg2);
}
",
  "client/src/input.ts": "import './input.css';

export const createInput = (
  placeholder: string = '',
  value: string = '',
  onInput?: (value: string) => void,
): HTMLInputElement => {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = placeholder;
  input.value = value;
  if (onInput) {
    input.addEventListener('input', () => onInput(input.value));
  }
  return input;
};
",
  "client/src/store.ts": "import {createMergeableStore} from 'tinybase';
import {SERVER} from './config';
import ReconnectingWebSocket from 'reconnecting-websocket';
import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

export const store = createMergeableStore().setDefaultContent([
  {
    todos: {
      '1': {text: 'Learn TinyBase', completed: false},
      '2': {text: 'Build an app', completed: false},
    },
  },
  {},
]);

const serverPathId = location.pathname;
createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
  });
});

export type TodosStore = typeof store;
",
  "client/src/todoInput.css": "#todoInput {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

#todoInput input {
  flex: 1;
}
",
  "client/src/todoInput.ts": "import './todoInput.css';
import {type TodosStore} from './store';
import {createButton} from './button';
import {createInput} from './input';

export const createTodoInput = (store: TodosStore): HTMLDivElement => {
  const container = document.createElement('div');
  container.id = 'todoInput';

  const input = createInput('What needs to be done?');

  const addTodo = () => {
    const text = input.value.trim();
    if (text) {
      store.addRow('todos', {text, completed: false});
      input.value = '';
      input.focus();
    }
  };

  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      addTodo();
    }
  });

  const addButton = createButton('Add', addTodo, 'primary');

  container.appendChild(input);
  container.appendChild(addButton);

  return container;
};
",
  "client/src/todoItem.css": ".todoItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
}

.todoItem:last-child {
  border-bottom: none;
}

.todoItem input[type='checkbox'] {
  width: 1.25rem;
  height: 1.25rem;
  cursor: pointer;
  flex-shrink: 0;
}

.todoItem label {
  flex: 1;
  cursor: pointer;
  user-select: none;
}

.todoItem.completed label {
  text-decoration: line-through;
  opacity: 0.6;
}

.todoItem button {
  flex-shrink: 0;
}
",
  "client/src/todoItem.ts": "import './todoItem.css';
import {createButton} from './button';

export const createTodoItem = (
  id: string,
  text: string,
  completed: boolean,
  onToggle: () => void,
  onDelete: () => void,
): HTMLDivElement => {
  const item = document.createElement('div');
  item.className = \`todoItem\${completed ? ' completed' : ''}\`;

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.checked = completed;
  checkbox.id = \`todo-\${id}\`;
  checkbox.addEventListener('change', onToggle);

  const label = document.createElement('label');
  label.textContent = text;
  label.htmlFor = \`todo-\${id}\`;

  const deleteBtn = createButton('Delete', onDelete);

  item.appendChild(checkbox);
  item.appendChild(label);
  item.appendChild(deleteBtn);

  return item;
};
",
  "client/src/todoList.css": "#todoList {
  border: 1px solid var(--border);
  border-radius: 0.375rem;
  overflow: hidden;
  background: var(--bg2);
}

#todoList:empty::before {
  content: 'No todos yet. Add one above!';
  display: block;
  padding: 2rem;
  text-align: center;
  color: var(--fg2);
}
",
  "client/src/todoList.ts": "import './todoList.css';
import {type TodosStore} from './store';
import {createTodoItem} from './todoItem';

export const createTodoList = (store: TodosStore): HTMLDivElement => {
  const list = document.createElement('div');
  list.id = 'todoList';

  const render = () => {
    const todos = store.getTable('todos');
    const todoIds = Object.keys(todos);

    list.innerHTML = '';
    todoIds.forEach((id) => {
      const todo = todos[id];
      const item = createTodoItem(
        id,
        todo.text,
        todo.completed,
        () => {
          store.setPartialRow('todos', id, {completed: !todo.completed});
        },
        () => {
          store.delRow('todos', id);
        },
      );
      list.appendChild(item);
    });
  };

  store.addTablesListener(render);
  render();

  return list;
};
",
  "client/src/vite-env.d.ts": "///
<reference types="vite/client" />;

declare module '*.css' {
  const content: string;
  export default content;
}
",
  "client/tsconfig.json": "{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
",
}
`;
