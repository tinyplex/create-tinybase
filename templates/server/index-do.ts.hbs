{{addImport "import {createMergeableStore} from 'tinybase';"}}
{{addImport "import {createDurableObjectSqlStoragePersister} from 'tinybase/persisters/persister-durable-object-sql-storage';"}}
{{addImport "import {getWsServerDurableObjectFetch, WsServerDurableObject} from 'tinybase/synchronizers/synchronizer-ws-server-durable-object';"}}

export class TinyBaseDurableObject extends WsServerDurableObject {
createPersister() {
const store = createMergeableStore();
const persister = createDurableObjectSqlStoragePersister(
store,
this.ctx.storage.sql,
);
return persister;
}
}

export default {
fetch: getWsServerDurableObjectFetch('TinyBaseDurableObjects'),
};