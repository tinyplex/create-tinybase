{{includeFile template="client/src/chat/messageInput.css.hbs" output="client/src/messageInput.css"}}
{{addImport "import {useState} from 'react';"}}
{{addImport "import {useAddRowCallback, STORE_ID as CHAT_STORE_ID} from './ChatStore';"}}
{{addImport "import {useValue, STORE_ID as SETTINGS_STORE_ID} from './SettingsStore';"}}
{{addImport "import './messageInput.css';"}}

{{includeFile template="client/src/shared/Button.tsx.hbs" output="client/src/Button.{{ext}}"}}
{{addImport "import {Button} from './Button';"}}

{{includeFile template="client/src/shared/Input.tsx.hbs" output="client/src/Input.{{ext}}"}}
{{addImport "import {Input} from './Input';"}}

export const MessageInput = () => {
const [message, setMessage] = useState('');
const username = useValue('username', SETTINGS_STORE_ID) || 'Anonymous';

const handleSend = useAddRowCallback(
'messages',
() => ({
username,
text: message,
timestamp: Date.now(),
}),
[message, username],
CHAT_STORE_ID,
);

const onSubmit = (e: React.FormEvent) => {
e.preventDefault();
if (message.trim()) {
handleSend();
setMessage('');
}
};

return (
<form onSubmit={onSubmit} id="messageInput">
  <Input value={message} onChange={setMessage} placeholder="Type a message..." autoFocus />
  <Button type="submit" variant="primary">Send</Button>
</form>
);
};
