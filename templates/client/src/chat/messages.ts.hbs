{{includeFile template="client/src/chat/messages.css.hbs" output="client/src/messages.css"}}
{{addImport "import './messages.css';"}}
{{addImport "import {type ChatStore} from './chatStore';"}}

{{includeFile template="client/src/chat/message.ts.hbs" output="client/src/message.{{ext}}"}}
{{addImport "import {createMessage} from './message';"}}

export const createMessages = (store: ChatStore): HTMLDivElement => {
const messagesContainer = document.createElement('div');
messagesContainer.id = 'messages';

const updateMessages = () => {
const messageRows = store.getTable('messages');
const sortedIds = Object.keys(messageRows).sort(
(a, b) => (messageRows[a].timestamp as number) - (messageRows[b].timestamp as number),
);

messagesContainer.innerHTML = '';
sortedIds.forEach((id) => {
const msg = messageRows[id];
const messageElement = createMessage(String(msg.username), String(msg.text), msg.timestamp as number);
messagesContainer.appendChild(messageElement);
});
};

updateMessages();

store.addTablesListener(updateMessages);

return messagesContainer;
};