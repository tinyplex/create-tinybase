{{#if schemas}}
  {{addImport "import {createMergeableStore} from 'tinybase/with-schemas';"}}
  {{addImport "import * as UiReact from 'tinybase/ui-react/with-schemas';"}}
  {{addImport "import {type NoValuesSchema} from 'tinybase/with-schemas';"}}
{{else}}
  {{addImport "import {createMergeableStore} from 'tinybase';"}}
  {{addImport "import {useCreateMergeableStore, useProvideStore, useAddRowCallback, useRow, useSortedRowIds, useStore} from 'tinybase/ui-react';"}}
{{/if}}

{{includeFile template="client/src/chat/utils.ts.hbs" output="client/src/utils.{{ext}}"}}
{{addImport "import {getDefaultContent} from './utils';"}}

timestamp: {type: 'number'},
},
} as const;

type Schemas = [typeof TABLES_SCHEMA, NoValuesSchema];

const {useCreateMergeableStore, useProvideStore, useAddRowCallback, useRow, useSortedRowIds, useStore} = UiReact as UiReact.WithSchemas<Schemas>;
  {{/if}}

  export {useAddRowCallback, useRow, useSortedRowIds, useStore};

  export const ChatStore = () => {
  const store = useCreateMergeableStore(() =>
  createMergeableStore(){{#if schemas}}
    .setTablesSchema(TABLES_SCHEMA){{/if}}
  .setDefaultContent(getDefaultContent()),
  {{#if sync}}
    {{includeFile template="client/src/shared/config.ts.hbs" output="client/src/config.ts"}}
    {{addImport "import {SERVER} from './config';"}}
    {{addImport "import ReconnectingWebSocket from 'reconnecting-websocket';"}}
    {{#if schemas}}
      {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client/with-schemas';"}}
    {{else}}
      {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';"}}
    {{/if}}
    {{#if schemas}}
      {{addImport "import {useCreateSynchronizer} from 'tinybase/ui-react/with-schemas';"}}
    {{else}}
      {{addImport "import {useCreateSynchronizer} from 'tinybase/ui-react';"}}
    {{/if}}

    useCreateSynchronizer(store, async (store) => {
    const serverPathId = location.pathname;
    const synchronizer = await createWsSynchronizer(
    store,
    new ReconnectingWebSocket(SERVER + serverPathId),
    );
    await synchronizer.startSync();

    synchronizer.getWebSocket().addEventListener('open', () => {
    synchronizer.load().then(() => synchronizer.save());
    });

    return synchronizer;
    });
  {{/if}}

  return null;
  };