{{#if schemas}}
  {{addImport "import {createMergeableStore} from 'tinybase/with-schemas';"}}
  {{addImport "import * as UiReact from 'tinybase/ui-react/with-schemas';"}}
  {{addImport "import {type NoValuesSchema} from 'tinybase/with-schemas';"}}
{{else}}
  {{addImport "import {createMergeableStore} from 'tinybase';"}}
  {{addImport "import {useCreateStore, useProvideStore, useAddRowCallback, useDelTableCallback, useRow, useRowIds, useStore, useTable} from 'tinybase/ui-react';"}}
{{/if}}
{{addImport "import {getUniqueId} from 'tinybase';"}}

export const STORE_ID = 'canvas';

{{#if schemas}}
  const TABLES_SCHEMA = {
  strokes: {
  color: {type: 'string'},
  size: {type: 'number'},
  points: {type: 'string'},
  },
  } as const;

  type Schemas = [typeof TABLES_SCHEMA, NoValuesSchema];

  const {useCreateStore, useProvideStore, useAddRowCallback, useDelTableCallback, useRow, useRowIds, useStore, useTable} = UiReact as UiReact.WithSchemas<Schemas>;
{{/if}}

export {useAddRowCallback, useDelTableCallback, useRow, useRowIds, useStore, useTable};

export const CanvasStore = () => {
const store = useCreateStore(() =>
createMergeableStore(){{#if schemas}}
  .setTablesSchema(TABLES_SCHEMA){{/if}}
.setDefaultContent([{strokes: {}}, {}]),
);

useProvideStore(STORE_ID, store);

{{#if sync}}
  {{includeFile template="client/src/shared/config.ts.hbs" output="client/src/config.ts"}}
  {{addImport "import {SERVER} from './config';"}}
  {{addImport "import ReconnectingWebSocket from 'reconnecting-websocket';"}}
  {{#if schemas}}
    {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client/with-schemas';"}}
  {{else}}
    {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';"}}
  {{/if}}
  {{addImport "import {useCreateSynchronizer} from 'tinybase/ui-react';"}}
  {{addImport "import type {MergeableStore} from 'tinybase';"}}

  useCreateSynchronizer(store, async (store: MergeableStore) => {
  const serverPathId = location.pathname;
  const synchronizer = await createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
  );
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
  synchronizer.load().then(() => synchronizer.save());
  });

  return synchronizer;
  });
{{/if}}

return null;
};