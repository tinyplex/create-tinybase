{{#if schemas}}
  {{addImport "import {createMergeableStore, type Row} from 'tinybase/with-schemas';"}}
  const TODOS_SCHEMA = {
  todos: {
  text: {type: 'string', default: ''},
  completed: {type: 'boolean', default: false},
  },
  } as const;
{{else}}
  {{addImport "import {createMergeableStore} from 'tinybase';"}}
{{/if}}

export type TodoRow = {{#if schemas}}Row<typeof TODOS_SCHEMA, 'todos'>{{else}}{text: string; completed: boolean}{{/if}};

export const store = createMergeableStore(){{#if schemas}}
  .setTablesSchema(TODOS_SCHEMA){{/if}}
.setDefaultContent([
{
todos: {
'1': {text: 'Learn TinyBase', completed: false},
'2': {text: 'Build an app', completed: false},
},
},
{},
]);

{{#if sync}}
  {{includeFile template="client/src/shared/config.ts.hbs" output="client/src/config.ts"}}
  {{addImport "import {SERVER} from './config';"}}
  {{addImport "import ReconnectingWebSocket from 'reconnecting-websocket';"}}
  {{#if schemas}}
    {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client/with-schemas';"}}
  {{else}}
    {{addImport "import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';"}}
  {{/if}}

  const serverPathId = location.pathname;
  createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
  ).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
  synchronizer.load().then(() => synchronizer.save());
  });
  });
{{/if}}

export type TodosStore = typeof store;