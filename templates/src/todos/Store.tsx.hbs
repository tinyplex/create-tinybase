{{#if schemas}}
  import {createMergeableStore} from 'tinybase/with-schemas';
  import * as UiReact from 'tinybase/ui-react/with-schemas';
  import {type NoValuesSchema} from 'tinybase/with-schemas';
{{else}}
  import {createMergeableStore} from 'tinybase';
  import {useCreateStore, useProvideStore, useAddRowCallback, useDelRowCallback, useRow, useRowIds, useSetPartialRowCallback} from 'tinybase/ui-react';
{{/if}}
{{#if sync}}
  import ReconnectingWebSocket from 'reconnecting-websocket';
  import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';
  import {useCreateSynchronizer} from 'tinybase/ui-react';
  import type {MergeableStore} from 'tinybase';

  const SERVER = 'wss://vite.tinybase.org';
{{/if}}

const STORE_ID = 'todos';

{{#if schemas}}
  const TODOS_SCHEMA = {
  todos: {
  text: {type: 'string'},
  completed: {type: 'boolean'},
  },
  } as const;

  type Schemas = [typeof TODOS_SCHEMA, NoValuesSchema];

  const {useCreateStore, useProvideStore, useAddRowCallback, useDelRowCallback, useRow, useRowIds, useSetPartialRowCallback} = UiReact as UiReact.WithSchemas<Schemas>;
{{/if}}

export {useAddRowCallback, useDelRowCallback, useRow, useRowIds, useSetPartialRowCallback};

export const Store = () => {
const store = useCreateStore(() =>
createMergeableStore(STORE_ID){{#if schemas}}
  .setTablesSchema(TODOS_SCHEMA){{/if}}
.setTable('todos', {
'1': {text: 'Learn TinyBase', completed: false},
'2': {text: 'Build an app', completed: false},
}),
);

useProvideStore(STORE_ID, store);

{{#if sync}}
  useCreateSynchronizer(store, async (store: MergeableStore) => {
  const serverPathId = location.pathname;
  const synchronizer = await createWsSynchronizer(
  store,
  new ReconnectingWebSocket(SERVER + serverPathId),
  );
  await synchronizer.startSync();

  // If the websocket reconnects in the future, do another explicit sync.
  synchronizer.getWebSocket().addEventListener('open', () => {
  synchronizer.load().then(() => synchronizer.save());
  });

  return synchronizer;
  });
{{/if}}

return null;
};