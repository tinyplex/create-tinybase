{{#if schemas}}
  import {createMergeableStore} from 'tinybase/with-schemas';
{{else}}
  import {createMergeableStore} from 'tinybase';
{{/if}}
{{#if sync}}
  import ReconnectingWebSocket from 'reconnecting-websocket';
  import {createWsSynchronizer} from 'tinybase/synchronizers/synchronizer-ws-client';

  const SERVER = 'wss://vite.tinybase.org';
{{/if}}

const STORE_ID = 'canvas';

{{#if schemas}}
  const TABLES_SCHEMA = {
  strokes: {
  points: {type: 'string'},
  color: {type: 'string'},
  size: {type: 'number'},
  },
  } as const;

{{/if}}
export const canvasStore = createMergeableStore(STORE_ID){{#if schemas}}
  .setTablesSchema(TABLES_SCHEMA){{/if}}
.setTable('strokes', {});

{{#if sync}}
  const serverPathId = location.pathname;
  createWsSynchronizer(
  canvasStore,
  new ReconnectingWebSocket(SERVER + serverPathId),
  ).then(async (synchronizer) => {
  await synchronizer.startSync();

  synchronizer.getWebSocket().addEventListener('open', () => {
  synchronizer.load().then(() => synchronizer.save());
  });
  });
{{/if}}

export type CanvasStore = typeof canvasStore;